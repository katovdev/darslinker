import { store } from '../../utils/store.js';
import { apiService } from '../../utils/api.js';
import { router } from '../../utils/router.js';

export function initDashboard() {
  console.log('=== Dashboard initializing ===');

  // Clean up any existing page-specific styles and reset body styles
  cleanupPageStyles();

  // Reset body styles
  document.body.style.overflow = '';
  document.body.style.height = '';
  document.body.style.paddingTop = '0';

  // Check if user is logged in
  const token = localStorage.getItem('accessToken');
  console.log('Token found:', !!token);

  if (!token) {
    console.log('No token, redirecting to login');
    router.navigate('/login');
    return;
  }

  // Get user data from session storage and update store
  const currentUserData = sessionStorage.getItem('currentUser');
  console.log('Raw currentUser from sessionStorage:', currentUserData);

  let userData = null;
  if (currentUserData && currentUserData !== 'undefined' && currentUserData !== 'null') {
    try {
      userData = JSON.parse(currentUserData);
    } catch (error) {
      console.error('Error parsing user data:', error);
      userData = null;
    }
  }
  console.log('Parsed user data:', userData);

  if (!userData) {
    console.log('No user data, redirecting to login');
    router.navigate('/login');
    return;
  }

  // Update store with user data
  store.setState({
    user: userData,
    isAuthenticated: true
  });

  console.log('User role:', userData.role);

  // Check user role and render appropriate dashboard
  console.log('User role detected:', userData.role);

  // Force teacher dashboard for testing
  console.log('Forcing teacher dashboard for testing');
  renderTeacherDashboard(userData);

  // Original logic (commented out for testing):
  // if (userData.role === 'teacher') {
  //   console.log('Rendering teacher dashboard');
  //   renderTeacherDashboard(userData);
  // } else {
  //   console.log('Rendering student dashboard');
  //   renderStudentDashboard(userData);
  // }

  console.log('=== Dashboard initialization complete ===');
  console.log('Final HTML check:', document.querySelector('#app').innerHTML.substring(0, 200));
}

function cleanupPageStyles() {
  // Remove page-specific styles
  const pagesToClean = ['#login-page-styles', '#password-page-styles', '#register-page-styles'];
  pagesToClean.forEach(styleId => {
    const styleElement = document.querySelector(styleId);
    if (styleElement) {
      styleElement.remove();
    }
  });
}

function renderTeacherDashboard(user) {
  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header exactly like Figma -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Teacher dashboard</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="startNewMeeting()">New meeting</button>
          <button class="figma-btn" onclick="openTelegramBot()">Telegram Bot</button>
          <button class="figma-btn figma-btn-primary" onclick="openCreateCourse()">New Course</button>
        </div>
      </div>

      <!-- Main Layout with Sidebar + Content -->
      <div class="figma-main-layout">
        ${getSidebarHTML()}

        <!-- Right Content Area -->
        <div class="figma-content-area">
          <!-- Profile Section -->
          <div class="figma-profile-section">
            <div class="figma-profile-avatar">
              <div class="figma-avatar-circle">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              </div>
            </div>
            <div class="figma-profile-info">
              <h2 class="figma-profile-name">${user.firstName} ${user.lastName}</h2>
              <p class="figma-profile-title">Web Development & UI/UX Design</p>
              <p class="figma-profile-location">Tashkent, Uzbekistan</p>
              <div class="figma-profile-rating">
                <div class="figma-stars">
                  <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="#ffd700">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                  <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="#ffd700">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                  <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="#ffd700">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                  <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="#ffd700">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                  <svg class="star-icon" width="14" height="14" viewBox="0 0 24 24" fill="#ffd700">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                </div>
                <span class="figma-rating-text">4.9 (324 reviews)</span>
                <span class="figma-joined">‚Ä¢ Joined 2025</span>
              </div>
            </div>
            <div class="figma-profile-buttons">
              <button class="figma-profile-btn" onclick="openEditProfile()">Edit profile</button>
              <button class="figma-profile-btn" onclick="customizeUI()">Customize UI</button>
            </div>
          </div>

          <!-- Stats Cards Grid -->
          <div class="figma-stats-grid">
            <!-- My Statistics Card -->
            <div class="figma-stats-card">
              <h3 class="figma-stats-title">My Statistics</h3>
              <div class="figma-stats-list">
                <div class="figma-stat-row">
                  <span class="figma-stat-label">Active Courses</span>
                  <span class="figma-stat-value">8</span>
                </div>
                <div class="figma-stat-row">
                  <span class="figma-stat-label">Total Students</span>
                  <span class="figma-stat-value">1111</span>
                </div>
                <div class="figma-stat-row">
                  <span class="figma-stat-label">Total Revenue</span>
                  <span class="figma-stat-value">$12,460</span>
                </div>
                <div class="figma-stat-row">
                  <span class="figma-stat-label">Avg. Rating</span>
                  <span class="figma-stat-value">4.9/5</span>
                </div>
              </div>
            </div>

            <!-- Achievements Card -->
            <div class="figma-stats-card">
              <h3 class="figma-stats-title">Achievements</h3>
              <div class="figma-achievements-list">
                <div class="figma-achievement-item">
                  <span class="figma-achievement-check">‚úì</span>
                  <span class="figma-achievement-text">Top Instructor</span>
                </div>
                <div class="figma-achievement-item">
                  <span class="figma-achievement-check">‚úì</span>
                  <span class="figma-achievement-text">1000+ Students</span>
                </div>
                <div class="figma-achievement-item">
                  <span class="figma-achievement-check">‚úì</span>
                  <span class="figma-achievement-text">$10K+ Revenue</span>
                </div>
                <div class="figma-achievement-item">
                  <span class="figma-achievement-check">‚úì</span>
                  <span class="figma-achievement-text">High Rating</span>
                </div>
              </div>
            </div>

            <!-- Bio & Specialties Card -->
            <div class="figma-stats-card">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 class="figma-stats-title">Bio & Specialties</h3>
                <button class="edit-bio-btn" onclick="editBio()" style="background: none; border: 1px solid #7ea2d4; color: #7ea2d4; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">Edit</button>
              </div>
              <p class="figma-bio-text" id="bioText">8+ years web development experience. Expert in React, UI/UX design, and teaching modern web technologies.</p>
              <div id="bioEditor" style="display: none;">
                <textarea id="bioTextarea" style="width: 100%; background: rgba(20, 20, 20, 0.8); border: 1px solid rgba(126, 162, 212, 0.2); border-radius: 8px; padding: 12px; color: #ffffff; font-family: inherit; font-size: 14px; line-height: 1.5; resize: vertical;" rows="4"></textarea>
                <div style="margin-top: 10px; display: flex; gap: 8px;">
                  <button onclick="saveBio()" style="background: #7ea2d4; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;">Save</button>
                  <button onclick="cancelBioEdit()" style="background: transparent; color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  // Load dashboard data
  loadTeacherDashboardData();

  // Set up event listeners
  setupTeacherEventListeners();
}

function renderStudentDashboard(user) {
  document.querySelector('#app').innerHTML = `
    <div class="dashboard-container">
      <header class="dashboard-header">
        <div class="container">
          <div class="dashboard-nav">
            <div class="nav-brand">
              <h1 class="brand-text">Dars <span class="brand-highlight">Linker</span></h1>
              <span class="user-role">O'quvchi Dashboard</span>
            </div>
            <div class="nav-actions">
              <span class="user-welcome">Salom, ${user.firstName} ${user.lastName}</span>
              <button class="btn-logout" onclick="handleLogout()">Chiqish</button>
            </div>
          </div>
        </div>
      </header>

      <main class="dashboard-main">
        <div class="container">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üìö</div>
              <div class="stat-content">
                <h3 id="enrolled-courses">0</h3>
                <p>Yozilgan kurslar</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-content">
                <h3 id="completed-courses">0</h3>
                <p>Tugallangan</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìù</div>
              <div class="stat-content">
                <h3 id="pending-assignments">0</h3>
                <p>Kutilayotgan vazifalar</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üèÜ</div>
              <div class="stat-content">
                <h3 id="achievements">0</h3>
                <p>Yutuqlar</p>
              </div>
            </div>
          </div>

          <div class="student-content">
            <h2>Davom etish</h2>
            <div class="continue-learning" id="continue-courses">
              <!-- Continue learning courses -->
            </div>

            <h2>Yangi kurslar</h2>
            <div class="available-courses" id="available-courses">
              <!-- Available courses -->
            </div>
          </div>
        </div>
      </main>
    </div>
  `;

  loadStudentDashboardData();
}

async function loadTeacherDashboardData() {
  try {
    // Load courses, students, assignments data
    // This would call your API endpoints

    // For now, let's add some sample data
    // Add null checks to prevent errors
    const coursesCount = document.getElementById('courses-count');
    const studentsCount = document.getElementById('students-count');
    const assignmentsCount = document.getElementById('assignments-count');
    const completedLessons = document.getElementById('completed-lessons');

    if (coursesCount) coursesCount.textContent = '5';
    if (studentsCount) studentsCount.textContent = '24';
    if (assignmentsCount) assignmentsCount.textContent = '12';
    if (completedLessons) completedLessons.textContent = '18';

    // Load recent courses
    loadRecentCourses();
    loadRecentActivity();

  } catch (error) {
    console.error('Error loading dashboard data:', error);
  }
}

async function loadStudentDashboardData() {
  try {
    // Load student-specific data
    // Add null checks to prevent errors
    const enrolledCourses = document.getElementById('enrolled-courses');
    const completedCourses = document.getElementById('completed-courses');
    const pendingAssignments = document.getElementById('pending-assignments');
    const achievements = document.getElementById('achievements');

    if (enrolledCourses) enrolledCourses.textContent = '3';
    if (completedCourses) completedCourses.textContent = '1';
    if (pendingAssignments) pendingAssignments.textContent = '4';
    if (achievements) achievements.textContent = '2';

  } catch (error) {
    console.error('Error loading student dashboard data:', error);
  }
}

function loadRecentCourses() {
  const coursesContainer = document.getElementById('recent-courses');

  // Check if container exists before trying to modify it
  if (!coursesContainer) {
    console.log('Recent courses container not found, skipping...');
    return;
  }

  // Sample courses data
  const courses = [
    {
      id: 1,
      title: 'JavaScript asoslari',
      students: 15,
      lessons: 8,
      image: 'https://via.placeholder.com/300x200?text=JS'
    },
    {
      id: 2,
      title: 'React.js kursi',
      students: 9,
      lessons: 12,
      image: 'https://via.placeholder.com/300x200?text=React'
    }
  ];

  coursesContainer.innerHTML = courses.map(course => `
    <div class="course-card">
      <img src="${course.image}" alt="${course.title}" class="course-image">
      <div class="course-content">
        <h3>${course.title}</h3>
        <div class="course-stats">
          <span>üë• ${course.students} o'quvchi</span>
          <span>üìñ ${course.lessons} dars</span>
        </div>
        <div class="course-actions">
          <button class="btn-edit">Tahrirlash</button>
          <button class="btn-view">Ko'rish</button>
        </div>
      </div>
    </div>
  `).join('');
}

function loadRecentActivity() {
  const activityContainer = document.getElementById('recent-activity');

  // Check if container exists before trying to modify it
  if (!activityContainer) {
    console.log('Recent activity container not found, skipping...');
    return;
  }

  const activities = [
    'Yangi o\'quvchi "JavaScript asoslari" kursiga yozildi',
    'Ahmed Ali 3-darsni yakunladi',
    'Yangi vazifa "React Components" yaratildi',
    'Madina Karimova kursingiz uchun 5 yulduz baho berdi'
  ];

  activityContainer.innerHTML = activities.map(activity => `
    <div class="activity-item">
      <div class="activity-icon">üîî</div>
      <span>${activity}</span>
      <small>2 soat oldin</small>
    </div>
  `).join('');
}

function setupTeacherEventListeners() {
  // Create course form submission
  const createCourseForm = document.getElementById('create-course-form');
  if (createCourseForm) {
    createCourseForm.addEventListener('submit', handleCreateCourse);
  }
}

async function handleCreateCourse(e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const courseData = {
    title: formData.get('title'),
    description: formData.get('description'),
    category: formData.get('category'),
    price: parseInt(formData.get('price'))
  };

  try {
    // Call API to create course
    // const result = await apiService.createCourse(courseData);

    alert('Kurs muvaffaqiyatli yaratildi!');
    closeModal('course-modal');
    loadRecentCourses(); // Refresh courses

  } catch (error) {
    console.error('Error creating course:', error);
    alert('Kurs yaratishda xatolik yuz berdi');
  }
}

// Global functions for onclick handlers
window.handleLogout = async function() {
  try {
    await apiService.logout();
    localStorage.removeItem('accessToken');
    store.setState({ user: null, isAuthenticated: false });
    router.navigate('/login');
  } catch (error) {
    console.error('Logout error:', error);
    // Force logout even if API call fails
    localStorage.removeItem('accessToken');
    store.setState({ user: null, isAuthenticated: false });
    router.navigate('/login');
  }
};

window.openCreateCourse = function() {
  document.getElementById('course-modal').classList.remove('hidden');
};

window.closeModal = function(modalId) {
  document.getElementById(modalId).classList.add('hidden');
};

window.openCreateLesson = function() {
  alert('Dars yaratish oynasi ishlab chiqilmoqda...');
};

window.openCreateAssignment = function() {
  alert('Vazifa yaratish oynasi ishlab chiqilmoqda...');
};

window.viewStudents = function() {
  alert('O\'quvchilar ro\'yxati oynasi ishlab chiqilmoqda...');
};

window.viewAllCourses = function() {
  alert('Barcha kurslar sahifasi ishlab chiqilmoqda...');
};

// New functions for the Figma design
window.openNewMeeting = function() {
  alert('New meeting functionality coming soon...');
};

window.openTelegramBot = function() {
  alert('Telegram Bot integration coming soon...');
};

window.editProfile = function() {
  openEditProfile();
};

window.openEditProfile = function() {
  const user = store.getState().user;
  
  // Update only the content area, keep sidebar
  const contentArea = document.querySelector('.figma-content-area');
  if (!contentArea) {
    // If no content area exists, we need to render full page
    renderFullPageWithSidebar('Edit Profile', getEditProfileContent(user));
    return;
  }
  
  // Update header title
  document.querySelector('.figma-title h2').textContent = 'Edit Profile';
  
  // Update content area only
  contentArea.innerHTML = getEditProfileContent(user);
  
  // Update active menu item
  document.querySelectorAll('.figma-menu-child').forEach(child => {
    child.classList.remove('active');
    if (child.textContent.trim() === 'Profile') {
      child.classList.add('active');
    }
  });
};

function getEditProfileContent(user) {
  return `
        <!-- Edit Profile Form -->
          <form class="edit-profile-form" id="editProfileForm">

            <!-- Personal Information Section -->
            <div class="profile-section">
              <h3 class="section-title">Personal Information</h3>

              <!-- Profile Picture -->
              <div class="profile-picture-section">
                <label class="field-label">Profile picture</label>
                <div class="profile-picture-upload">
                  <div class="profile-picture-preview">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                  </div>
                  <div class="upload-instructions">
                    <p>Click to upload or drag and drop</p>
                    <small>PNG, JPG up to 5MB</small>
                  </div>
                </div>
              </div>

              <!-- Name Fields -->
              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">First Name</label>
                  <input type="text" class="form-input" value="${user.firstName || 'John'}" />
                </div>
                <div class="form-field">
                  <label class="field-label">Last Name</label>
                  <input type="text" class="form-input" value="${user.lastName || 'Smith'}" />
                </div>
              </div>

              <!-- Professional Title -->
              <div class="form-field">
                <label class="field-label">Professional Title / Specialty</label>
                <input type="text" class="form-input" value="Web Development & UI/UX Design" />
              </div>

              <!-- Bio -->
              <div class="form-field">
                <label class="field-label">Bio / About Me</label>
                <textarea class="form-textarea" rows="4">8+ years web development experience. Expert in React, UI/UX design, and teaching modern web technologies. Passionate about helping students achieve their goals!</textarea>
              </div>

              <!-- Location -->
              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">City</label>
                  <input type="text" class="form-input" value="Tashkent" />
                </div>
                <div class="form-field">
                  <label class="field-label">Country</label>
                  <input type="text" class="form-input" value="Uzbekistan" />
                </div>
              </div>
            </div>

            <!-- Contact Information Section -->
            <div class="profile-section">
              <h3 class="section-title">Contact information</h3>

              <div class="form-field">
                <label class="field-label">Email Address</label>
                <input type="email" class="form-input" value="${user.email || 'john@example.com'}" />
              </div>

              <div class="form-field">
                <label class="field-label">Phone Number</label>
                <input type="tel" class="form-input" value="+998 99 123 45 67" />
              </div>

              <div class="form-field">
                <label class="field-label">Telegram Username</label>
                <input type="text" class="form-input" value="@john_teacher" />
              </div>
            </div>

            <!-- Save Button -->
            <div class="form-actions">
              <button type="submit" class="btn-save-profile">Save Changes</button>
              <button type="button" class="btn-cancel-profile" onclick="backToDashboard()">Cancel</button>
            </div>
          </form>
  `;
}

function renderFullPageWithSidebar(title, content) {
  const user = store.getState().user;
  
  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Edit Profile Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>${title}</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="backToDashboard()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
            </svg>
            Back
          </button>
        </div>
      </div>

      <!-- Edit Profile Content -->
      <div class="figma-main-layout">
        ${getSidebarHTML()}
        
        <!-- Content Area -->
        <div class="figma-content-area">
          ${content}
        </div>
      </div>
    </div>
  `;
}

function getSidebarHTML() {
  return `
        <!-- Left Sidebar -->
        <div class="figma-sidebar">
          <!-- General Menu (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard(); return false;">Dashboard</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openEditProfile(); return false;">Profile</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMessagesPage(); return false;">Messages</a>
            </div>
          </div>

          <!-- Content Management (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openCreateCourse(); return false;">Create Course</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMyCourses(); return false;">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft'); return false;">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived'); return false;">Archived</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openFinancePage(); return false;">Finance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openAssignmentsPage(); return false;">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('ai')">
              <span class="figma-menu-title">AI Assistant</span>
              <span class="figma-menu-arrow" id="ai-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="ai-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openAIAssistantPage(); return false;">AI Assistant</a>
            </div>
          </div>

          <!-- Analytics (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('analytics')">
              <span class="figma-menu-title">Analytics</span>
              <span class="figma-menu-arrow" id="analytics-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="analytics-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openQuizAnalytics(); return false;">Quiz Analytics</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Rating Comments</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Students Analytics</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Engagement</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Progress</a>
            </div>
          </div>

          <!-- Rolls (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('rolls')">
              <span class="figma-menu-title">Rolls</span>
              <span class="figma-menu-arrow" id="rolls-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="rolls-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Sub Admin</a>
            </div>
          </div>

          <!-- Settings (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('settings')">
              <span class="figma-menu-title">Settings</span>
              <span class="figma-menu-arrow" id="settings-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="settings-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Language</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); return false;">Customize UI</a>
            </div>
          </div>

          <!-- Subscription at bottom -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link" onclick="return false;">My Subscription</a>
            </div>
          </div>
        </div>
  `;
}

window.customizeUI = function() {
  alert('UI customization coming soon...');
};

// Menu toggle function (accordion style - close others when opening one)
window.toggleMenu = function(menuName) {
                <label class="field-label">Professional Title / Specialty</label>
                <input type="text" class="form-input" value="Web Development & UI/UX Design" />
              </div>

              <!-- Bio -->
              <div class="form-field">
                <label class="field-label">Bio / About Me</label>
                <textarea class="form-textarea" rows="4">8+ years web development experience. Expert in React, UI/UX design, and teaching modern web technologies. Passionate about helping students achieve their goals!</textarea>
              </div>

              <!-- Location -->
              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">City</label>
                  <input type="text" class="form-input" value="Tashkent" />
                </div>
                <div class="form-field">
                  <label class="field-label">Country</label>
                  <input type="text" class="form-input" value="Uzbekistan" />
                </div>
              </div>
            </div>

            <!-- Contact Information Section -->
            <div class="profile-section">
              <h3 class="section-title">Contact information</h3>

              <div class="form-field">
                <label class="field-label">Email Address</label>
                <input type="email" class="form-input" value="${user.email || 'john@example.com'}" />
              </div>

              <div class="form-field">
                <label class="field-label">Phone Number</label>
                <input type="tel" class="form-input" value="+998 99 123 45 67" />
              </div>

              <div class="form-field">
                <label class="field-label">Telegram Username</label>
                <input type="text" class="form-input" value="@john_teacher" />
              </div>
            </div>

            <!-- Payment Information Section -->
            <div class="profile-section">
              <h3 class="section-title">Payment Information</h3>

              <div class="form-field">
                <label class="field-label">Account Holder Name</label>
                <input type="text" class="form-input" value="John Smith" />
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">Bank name</label>
                  <input type="text" class="form-input" value="" />
                </div>
                <div class="form-field">
                  <label class="field-label">Card Number</label>
                  <input type="text" class="form-input" value="" />
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <button type="button" class="btn-cancel" onclick="backToDashboard()">Cancel</button>
              <button type="submit" class="btn-save">Save changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  `;

  // Add form submission handler
  document.getElementById('editProfileForm').addEventListener('submit', handleProfileSave);
};

window.customizeUI = function() {
  alert('UI customization coming soon...');
};

// Menu toggle function (accordion style - close others when opening one)
window.toggleMenu = function(menuName) {
  const allMenus = ['general', 'content', 'ai', 'analytics', 'rolls', 'settings'];
  const children = document.getElementById(menuName + '-children');
  const arrow = document.getElementById(menuName + '-arrow');
  const parent = arrow.parentElement;

  // Check if this menu is currently open
  const isCurrentlyOpen = !children.classList.contains('hidden');

  // Close all menus first and remove expanded class
  allMenus.forEach(menu => {
    const menuChildren = document.getElementById(menu + '-children');
    const menuArrow = document.getElementById(menu + '-arrow');
    const menuParent = menuArrow ? menuArrow.parentElement : null;

    if (menuChildren && menuArrow && menuParent) {
      menuChildren.classList.add('hidden');
      menuArrow.textContent = '‚ñ∂';
      menuParent.classList.remove('expanded');
    }
  });

  // If the clicked menu was closed, open it
  if (isCurrentlyOpen) {
    // Keep it closed (it was open, now we closed all, so leave it closed)
    children.classList.add('hidden');
    arrow.textContent = '‚ñ∂';
    parent.classList.remove('expanded');
  } else {
    // Open the clicked menu
    children.classList.remove('hidden');
    arrow.textContent = '‚ñº';
    parent.classList.add('expanded');
  }
};

// Set active menu child
window.setActiveChild = function(element, event) {
  // Prevent default link behavior first
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }

  // Remove active from all menu children
  document.querySelectorAll('.figma-menu-child').forEach(child => {
    child.classList.remove('active');
  });

  // Add active to clicked element
  element.classList.add('active');

  // Don't close the menu or navigate away
  return false;
};

// Back to dashboard function
window.backToDashboard = function() {
  initDashboard();
};

// Handle profile save
function handleProfileSave(e) {
  e.preventDefault();
  alert('Profile saved successfully!');
  // Here you would normally save the form data to the backend
  backToDashboard();
}

// Open Messages Page
window.openMessagesPage = function() {
  const userData = store.getState().user;

  // Check current general menu state before navigating
  const generalChildren = document.getElementById('general-children');
  const generalArrow = document.getElementById('general-arrow');
  const isGeneralExpanded = generalChildren && !generalChildren.classList.contains('hidden');

  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Messages</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="backToDashboard()">‚Üê Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isGeneralExpanded ? 'expanded' : ''}" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">${isGeneralExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isGeneralExpanded ? '' : 'hidden'}" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openEditProfile()">Profile</a>
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event)">Messages</a>
            </div>
          </div>

          <!-- Content Management (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Lessons</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Materials</a>
            </div>
          </div>

          <!-- AI Assistant (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="openAIAssistantPage(); return false;">
              <span class="figma-menu-title">AI Assistant</span>
              <span class="figma-menu-arrow" id="ai-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="ai-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Chat Assistant</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Content Generator</a>
            </div>
          </div>

          <!-- Analytics (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('analytics')">
              <span class="figma-menu-title">Analytics</span>
              <span class="figma-menu-arrow" id="analytics-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="analytics-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Student Progress</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Course Analytics</a>
            </div>
          </div>

          <!-- Rolls (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('rolls')">
              <span class="figma-menu-title">Rolls</span>
              <span class="figma-menu-arrow" id="rolls-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="rolls-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Attendance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Grade Book</a>
            </div>
          </div>

          <!-- Settings (Expandable) -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('settings')">
              <span class="figma-menu-title">Settings</span>
              <span class="figma-menu-arrow" id="settings-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="settings-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Account Settings</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this)">Preferences</a>
            </div>
          </div>

          <!-- Subscription at bottom -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- Messages Content -->
        <div class="figma-content-area">
          <div class="messages-container">
            <!-- Simple Messages Interface -->
            <div class="messages-welcome">
              <div class="messages-header">
                <h3>Messages</h3>
                <button class="create-group-btn" onclick="createGroup()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Create Group
                </button>
              </div>

              <div class="messages-placeholder">
                <div class="placeholder-icon">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
                <h3>Select a chat to start messaging</h3>
                <p>Choose from your existing conversations or create a new group</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
};

// Create Group Function
window.createGroup = function() {
  alert('Group create functionality will be implemented here!');
  // Here you would implement the group creation logic
};

// Trigger File Upload
window.triggerFileUpload = function() {
  document.getElementById('thumbnailInput').click();
};

// Handle Image Upload
window.handleImageUpload = function(event) {
  const file = event.target.files[0];
  if (file) {
    // Check file size (5MB limit)
    if (file.size > 5 * 1024 * 1024) {
      alert('File size must be less than 5MB');
      return;
    }

    // Check file type
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const uploadContent = document.getElementById('uploadContent');
      const imagePreview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');

      previewImg.src = e.target.result;
      uploadContent.classList.add('hidden');
      imagePreview.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  }
};

// Change Image
window.changeImage = function(event) {
  event.stopPropagation();
  document.getElementById('thumbnailInput').click();
};

// Delete Image
window.deleteImage = function(event) {
  event.stopPropagation();
  const uploadContent = document.getElementById('uploadContent');
  const imagePreview = document.getElementById('imagePreview');
  const thumbnailInput = document.getElementById('thumbnailInput');

  uploadContent.classList.remove('hidden');
  imagePreview.classList.add('hidden');
  thumbnailInput.value = '';
};

// Add Lesson Function
window.addLesson = function(type, dropdownLink) {
  const moduleItem = dropdownLink.closest('.module-item');
  const lessonsList = moduleItem.querySelector('.lessons-list');
  const addDropdown = lessonsList.querySelector('.add-lesson-dropdown');

  // Hide dropdown
  dropdownLink.closest('.dropdown-menu').style.display = 'none';

  // Get lesson count for numbering
  const existingLessons = lessonsList.querySelectorAll('.lesson-item').length;
  const lessonNumber = existingLessons + 1;

  let lessonHTML = '';

  switch(type) {
    case 'video':
      lessonHTML = `
        <div class="lesson-form">
          <h5>Add Video Lesson ${lessonNumber}</h5>
          <div class="form-group">
            <label>Lesson Title</label>
            <input type="text" placeholder="Enter lesson title" />
          </div>
          <div class="form-group">
            <label>Video File</label>
            <input type="file" accept="video/*" />
          </div>
          <div class="form-group">
            <label>Duration (minutes)</label>
            <input type="number" placeholder="0" />
          </div>
          <div class="form-actions">
            <button type="button" class="save-lesson-btn" onclick="saveLesson(this, 'video')">Save Lesson</button>
            <button type="button" class="cancel-lesson-btn" onclick="cancelLesson(this)">Cancel</button>
          </div>
        </div>
      `;
      break;

    case 'quiz':
      lessonHTML = `
        <div class="lesson-form">
          <h5>Add Quiz ${lessonNumber}</h5>
          <div class="form-group">
            <label>Quiz Title</label>
            <input type="text" placeholder="Enter quiz title" />
          </div>
          <div class="form-group">
            <label>Time Limit (minutes)</label>
            <input type="number" placeholder="30" />
          </div>
          <div class="form-group">
            <label>Number of Questions</label>
            <input type="number" placeholder="10" />
          </div>
          <div class="form-actions">
            <button type="button" class="save-lesson-btn" onclick="saveLesson(this, 'quiz')">Save Quiz</button>
            <button type="button" class="cancel-lesson-btn" onclick="cancelLesson(this)">Cancel</button>
          </div>
        </div>
      `;
      break;

    case 'assignment':
      lessonHTML = `
        <div class="lesson-form">
          <h5>Add Assignment ${lessonNumber}</h5>
          <div class="form-group">
            <label>Assignment Title</label>
            <input type="text" placeholder="Enter assignment title" />
          </div>
          <div class="form-group">
            <label>Instructions</label>
            <textarea placeholder="Enter assignment instructions" rows="4"></textarea>
          </div>
          <div class="form-group">
            <label>Due Date</label>
            <input type="datetime-local" />
          </div>
          <div class="form-actions">
            <button type="button" class="save-lesson-btn" onclick="saveLesson(this, 'assignment')">Save Assignment</button>
            <button type="button" class="cancel-lesson-btn" onclick="cancelLesson(this)">Cancel</button>
          </div>
        </div>
      `;
      break;

    case 'file':
      lessonHTML = `
        <div class="lesson-form">
          <h5>Add File Lesson ${lessonNumber}</h5>
          <div class="form-group">
            <label>Lesson Title</label>
            <input type="text" placeholder="Enter lesson title" />
          </div>
          <div class="form-group">
            <label>File Upload</label>
            <input type="file" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt" />
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea placeholder="Describe this file and what students should learn" rows="3"></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="save-lesson-btn" onclick="saveLesson(this, 'file')">Save Lesson</button>
            <button type="button" class="cancel-lesson-btn" onclick="cancelLesson(this)">Cancel</button>
          </div>
        </div>
      `;
      break;
  }

  // Insert the form before the add dropdown
  addDropdown.insertAdjacentHTML('beforebegin', lessonHTML);
};

// Save Lesson Function
window.saveLesson = function(button, type) {
  const lessonForm = button.closest('.lesson-form');
  const inputs = lessonForm.querySelectorAll('input, textarea');
  const moduleItem = lessonForm.closest('.module-item');
  const lessonsList = moduleItem.querySelector('.lessons-list');

  // Get form data
  let lessonTitle = '';
  let duration = '';

  // Extract lesson title from first input
  const titleInput = lessonForm.querySelector('input[type="text"]');
  if (titleInput && titleInput.value.trim()) {
    lessonTitle = titleInput.value.trim();
  } else {
    alert('Please enter a lesson title');
    return;
  }

  // Get duration for display
  if (type === 'video') {
    const durationInput = lessonForm.querySelector('input[type="number"]');
    duration = durationInput && durationInput.value ? durationInput.value + ' min' : '0 min';
  } else if (type === 'quiz') {
    const timeInput = lessonForm.querySelector('input[type="number"]');
    duration = timeInput && timeInput.value ? timeInput.value + ' min' : '30 min';
  } else if (type === 'assignment') {
    duration = 'Assignment';
  } else if (type === 'file') {
    duration = 'File';
  }

  // Create lesson item HTML
  const lessonHTML = `
    <div class="lesson-item">
      <span>${lessonTitle}</span>
      <span>${duration}</span>
    </div>
  `;

  // Insert before the lesson form
  lessonForm.insertAdjacentHTML('beforebegin', lessonHTML);

  // Remove the form
  lessonForm.remove();

  // Update module info (lesson count)
  updateModuleInfo(moduleItem);
};

// Cancel Lesson Function
window.cancelLesson = function(button) {
  const lessonForm = button.closest('.lesson-form');
  lessonForm.remove();
};

// Update Module Info
function updateModuleInfo(moduleItem) {
  const lessons = moduleItem.querySelectorAll('.lesson-item').length;
  const moduleInfo = moduleItem.querySelector('.module-info p');

  // Calculate total duration (simplified)
  let totalMinutes = 0;
  const lessonItems = moduleItem.querySelectorAll('.lesson-item');
  lessonItems.forEach(lesson => {
    const timeText = lesson.querySelector('span:last-child').textContent;
    if (timeText.includes('min')) {
      const minutes = parseInt(timeText);
      if (!isNaN(minutes)) {
        totalMinutes += minutes;
      }
    }
  });

  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  let timeDisplay = '';

  if (hours > 0) {
    timeDisplay = `${hours} hour${hours > 1 ? 's' : ''}`;
    if (minutes > 0) {
      timeDisplay += ` ${minutes} min`;
    }
  } else {
    timeDisplay = `${minutes} min`;
  }

  moduleInfo.textContent = `${lessons} lesson${lessons !== 1 ? 's' : ''} ‚Ä¢ ${timeDisplay}`;
}

// Add New Module Function
window.addNewModule = function() {
  const modulesContainer = document.getElementById('modulesContainer');
  const existingModules = modulesContainer.querySelectorAll('.module-item').length;
  const newModuleNumber = existingModules + 1;

  const newModuleHTML = `
    <div class="module-item">
      <div class="module-header" onclick="toggleModule(this)">
        <div class="module-info">
          <h4>Module ${newModuleNumber}: New Module</h4>
          <p>0 lessons ‚Ä¢ 0 hours</p>
        </div>
        <div class="module-actions" onclick="event.stopPropagation()">
          <button type="button" class="action-btn" onclick="editModule(this)">Edit</button>
          <button type="button" class="action-btn delete" onclick="deleteModule(this)">Delete</button>
        </div>
      </div>
      <div class="lessons-list" style="display: none;">
        <div class="add-lesson-dropdown">
          <button type="button" class="add-btn dropdown-toggle" onclick="toggleLessonDropdown(this)">+ Add</button>
          <div class="dropdown-menu">
            <a href="#" onclick="addLesson('video', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2"/>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              </svg>
              Video
            </a>
            <a href="#" onclick="addLesson('quiz', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2"/>
                <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2"/>
              </svg>
              Quiz
            </a>
            <a href="#" onclick="addLesson('assignment', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
              </svg>
              Assignment
            </a>
            <a href="#" onclick="addLesson('file', this)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2"/>
                <polyline points="13,2 13,9 20,9" stroke="currentColor" stroke-width="2"/>
              </svg>
              File
            </a>
          </div>
        </div>
      </div>
    </div>
  `;

  // Insert before the "Add new module" button
  const addButton = modulesContainer.querySelector('.add-module-btn');
  addButton.insertAdjacentHTML('beforebegin', newModuleHTML);
};

// Toggle Module Expand/Collapse
window.toggleModule = function(moduleHeader) {
  const lessonsList = moduleHeader.nextElementSibling;
  const isVisible = lessonsList.style.display !== 'none';

  if (isVisible) {
    lessonsList.style.display = 'none';
    moduleHeader.classList.remove('expanded');
  } else {
    lessonsList.style.display = 'block';
    moduleHeader.classList.add('expanded');
  }
};

// Edit Module
window.editModule = function(button) {
  const moduleHeader = button.closest('.module-header');
  const moduleTitle = moduleHeader.querySelector('h4');
  const currentTitle = moduleTitle.textContent;

  const newTitle = prompt('Enter new module title:', currentTitle);
  if (newTitle && newTitle.trim()) {
    moduleTitle.textContent = newTitle.trim();
  }
};

// Delete Module
window.deleteModule = function(button) {
  if (confirm('Are you sure you want to delete this module?')) {
    const moduleItem = button.closest('.module-item');
    moduleItem.remove();

    // Renumber remaining modules
    const modulesContainer = document.getElementById('modulesContainer');
    const modules = modulesContainer.querySelectorAll('.module-item');
    modules.forEach((module, index) => {
      const title = module.querySelector('h4');
      const titleText = title.textContent;
      const colonIndex = titleText.indexOf(':');
      if (colonIndex !== -1) {
        const newTitle = `Module ${index + 1}:${titleText.substring(colonIndex + 1)}`;
        title.textContent = newTitle;
      }
    });
  }
};

// Toggle Lesson Dropdown
window.toggleLessonDropdown = function(button) {
  const dropdown = button.nextElementSibling;
  const isVisible = dropdown.style.display === 'block';

  // Close all other dropdowns first
  document.querySelectorAll('.dropdown-menu').forEach(menu => {
    if (menu !== dropdown) {
      menu.style.display = 'none';
    }
  });

  dropdown.style.display = isVisible ? 'none' : 'block';

  // Close dropdown when clicking outside
  if (!isVisible) {
    setTimeout(() => {
      document.addEventListener('click', function closeDropdown(e) {
        if (!button.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
          document.removeEventListener('click', closeDropdown);
        }
      });
    }, 0);
  }
};

// Open My Courses Page
window.openMyCourses = function() {
  const userData = store.getState().user;

  // Preserve sidebar menu state
  const generalChildren = document.getElementById('general-children');
  const isGeneralExpanded = generalChildren && !generalChildren.classList.contains('hidden');
  const contentChildren = document.getElementById('content-children');
  const isContentExpanded = contentChildren && !contentChildren.classList.contains('hidden');
  const aiChildren = document.getElementById('ai-children');
  const isAiExpanded = aiChildren && !aiChildren.classList.contains('hidden');
  const analyticsChildren = document.getElementById('analytics-children');
  const isAnalyticsExpanded = analyticsChildren && !analyticsChildren.classList.contains('hidden');
  const rollsChildren = document.getElementById('rolls-children');
  const isRollsExpanded = rollsChildren && !rollsChildren.classList.contains('hidden');
  const settingsChildren = document.getElementById('settings-children');
  const isSettingsExpanded = settingsChildren && !settingsChildren.classList.contains('hidden');

  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>My courses</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn figma-btn-primary" onclick="openCreateCourse()">+ New Course</button>
          <button class="figma-btn" onclick="backToDashboard()">‚Üê Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isGeneralExpanded ? 'expanded' : ''}" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">${isGeneralExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isGeneralExpanded ? '' : 'hidden'}" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openEditProfile()">Profile</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMessagesPage()">Messages</a>
            </div>
          </div>

          <!-- Content Management -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isContentExpanded ? 'expanded' : ''}" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">${isContentExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isContentExpanded ? '' : 'hidden'}" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openCreateCourse()">Create Course</a>
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event)" id="my-courses-menu">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft')">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived')">Archived</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openFinancePage()">Finance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openAssignmentsPage()">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isAiExpanded ? 'expanded' : ''}" onclick="toggleMenu('ai')">
              <span class="figma-menu-title">AI Assistant</span>
              <span class="figma-menu-arrow" id="ai-arrow">${isAiExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isAiExpanded ? '' : 'hidden'}" id="ai-children">
              <a href="#" class="figma-menu-child">AI Assistant</a>
            </div>
          </div>

          <!-- Analytics -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isAnalyticsExpanded ? 'expanded' : ''}" onclick="toggleMenu('analytics')">
              <span class="figma-menu-title">Analytics</span>
              <span class="figma-menu-arrow" id="analytics-arrow">${isAnalyticsExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isAnalyticsExpanded ? '' : 'hidden'}" id="analytics-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openQuizAnalytics()">Quiz Analytics</a>
              <a href="#" class="figma-menu-child">Rating Comments</a>
              <a href="#" class="figma-menu-child">Students Analytics</a>
              <a href="#" class="figma-menu-child">Engagement</a>
              <a href="#" class="figma-menu-child">Progress</a>
            </div>
          </div>

          <!-- Rolls -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isRollsExpanded ? 'expanded' : ''}" onclick="toggleMenu('rolls')">
              <span class="figma-menu-title">Rolls</span>
              <span class="figma-menu-arrow" id="rolls-arrow">${isRollsExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isRollsExpanded ? '' : 'hidden'}" id="rolls-children">
              <a href="#" class="figma-menu-child">Sub Admin</a>
            </div>
          </div>

          <!-- Settings -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isSettingsExpanded ? 'expanded' : ''}" onclick="toggleMenu('settings')">
              <span class="figma-menu-title">Settings</span>
              <span class="figma-menu-arrow" id="settings-arrow">${isSettingsExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isSettingsExpanded ? '' : 'hidden'}" id="settings-children">
              <a href="#" class="figma-menu-child">Language</a>
              <a href="#" class="figma-menu-child">Customize UI</a>
            </div>
          </div>

          <!-- Subscription at bottom -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- My Courses Content -->
        <div class="figma-content-area">
          <!-- Statistics Cards -->
          <div class="my-courses-stats" id="coursesStats">
            <!-- Statistics will be rendered dynamically -->
          </div>

          <!-- Search and Sort Section -->
          <div class="courses-controls">
            <div class="search-section">
              <div class="search-input-wrapper">
                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
                <input type="text" id="courseSearchInput" placeholder="Search courses..." oninput="searchCourses()">
              </div>
            </div>
            <div class="sort-section">
              <select id="courseSortSelect" onchange="sortCourses()">
                <option value="newest">Newest first</option>
                <option value="oldest">Oldest first</option>
                <option value="name-asc">Name A-Z</option>
                <option value="name-desc">Name Z-A</option>
                <option value="students-desc">Most students</option>
                <option value="revenue-desc">Highest revenue</option>
                <option value="rating-desc">Best rating</option>
              </select>
            </div>
          </div>

          <!-- Course Filter Tabs -->
          <div class="course-filter-tabs" id="courseFilterTabs">
            <!-- Filter tabs will be rendered dynamically -->
          </div>

          <!-- Course Cards Grid -->
          <div class="my-courses-grid" id="myCoursesGrid">
            <!-- Course cards will be injected here -->
          </div>

          <!-- Add Course Section -->
          <div class="add-course-section">
            <div class="add-course-card" onclick="openCreateCourse()">
              <div class="add-course-content">
                <div class="add-course-text">ADD COURSE</div>
                <div class="add-course-icon">+</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  // Load course data and initialize page
  updateCoursesStatistics();
  updateFilterTabs();
  renderMyCoursesCards();

  // Check if there's a pending filter from sidebar navigation
  const pendingFilter = sessionStorage.getItem('pendingFilter');
  if (pendingFilter) {
    sessionStorage.removeItem('pendingFilter');
    // Apply the pending filter after a short delay to ensure page is fully loaded
    setTimeout(() => {
      applyFilterFromSidebar(pendingFilter);
    }, 100);
  }
};

// Enhanced interactive course data
let myCoursesData = [
  {
    id: 1,
    title: 'Complete Web Development Bootcamp',
    description: 'Master HTML, CSS, JavaScript, React and Node.js from scratch',
    students: 324,
    lessons: 42,
    price: 199,
    revenue: 6450,
    rating: 4.9,
    status: 'Active',
    type: 'Paid',
    category: 'Web Development',
    color: '#4A90E2',
    createdAt: '2024-01-15',
    updatedAt: '2024-11-10'
  },
  {
    id: 2,
    title: 'UI/UX Design Masterclass',
    description: 'Learn modern UI/UX design principles, Figma, prototyping and user research',
    students: 187,
    lessons: 28,
    price: 149,
    revenue: 2798,
    rating: 4.7,
    status: 'Active',
    type: 'Paid',
    category: 'Design',
    color: '#8B5CF6',
    createdAt: '2024-02-20',
    updatedAt: '2024-11-08'
  },
  {
    id: 3,
    title: 'Python for Beginners',
    description: 'Start your programming journey with Python basics and data structures',
    students: 445,
    lessons: 35,
    price: 99,
    revenue: 4405,
    rating: 4.8,
    status: 'Active',
    type: 'Paid',
    category: 'Programming',
    color: '#10B981',
    createdAt: '2024-01-10',
    updatedAt: '2024-11-05'
  },
  {
    id: 4,
    title: 'React Native Mobile Apps',
    description: 'Build cross-platform mobile applications with React Native',
    students: 89,
    lessons: 52,
    price: 249,
    revenue: 2216,
    rating: 4.6,
    status: 'Draft',
    type: 'Paid',
    category: 'Mobile Development',
    color: '#F59E0B',
    createdAt: '2024-10-15',
    updatedAt: '2024-11-11'
  },
  {
    id: 5,
    title: 'Digital Marketing Strategy',
    description: 'Complete guide to digital marketing, SEO, and social media marketing',
    students: 156,
    lessons: 24,
    price: 79,
    revenue: 1232,
    rating: 4.5,
    status: 'Active',
    type: 'Paid',
    category: 'Marketing',
    color: '#EF4444',
    createdAt: '2024-03-05',
    updatedAt: '2024-10-30'
  },
  {
    id: 6,
    title: 'Introduction to Programming',
    description: 'Free course covering basic programming concepts and logic',
    students: 892,
    lessons: 18,
    price: 0,
    revenue: 0,
    rating: 4.3,
    status: 'Active',
    type: 'Free',
    category: 'Programming',
    color: '#6366F1',
    createdAt: '2024-01-01',
    updatedAt: '2024-10-25'
  },
  {
    id: 7,
    title: 'Advanced JavaScript Concepts',
    description: 'Deep dive into closures, async/await, and modern JS features',
    students: 67,
    lessons: 31,
    price: 179,
    revenue: 1201,
    rating: 4.9,
    status: 'Draft',
    type: 'Paid',
    category: 'Programming',
    color: '#F97316',
    createdAt: '2024-09-20',
    updatedAt: '2024-11-09'
  },
  {
    id: 8,
    title: 'Cybersecurity Fundamentals',
    description: 'Learn ethical hacking, network security and cybersecurity basics',
    students: 234,
    lessons: 40,
    price: 199,
    revenue: 4658,
    rating: 4.7,
    status: 'Archived',
    type: 'Paid',
    category: 'Security',
    color: '#DC2626',
    createdAt: '2023-11-15',
    updatedAt: '2024-05-20'
  },
  {
    id: 9,
    title: 'Data Science with Python',
    description: 'Learn pandas, numpy, matplotlib and machine learning basics',
    students: 178,
    lessons: 48,
    price: 229,
    revenue: 4074,
    rating: 4.8,
    status: 'Active',
    type: 'Paid',
    category: 'Data Science',
    color: '#059669',
    createdAt: '2024-04-10',
    updatedAt: '2024-11-01'
  },
  {
    id: 10,
    title: 'Blockchain Development',
    description: 'Build smart contracts and decentralized applications with Solidity',
    students: 23,
    lessons: 35,
    price: 299,
    revenue: 688,
    rating: 4.4,
    status: 'Draft',
    type: 'Paid',
    category: 'Blockchain',
    color: '#7C2D12',
    createdAt: '2024-08-15',
    updatedAt: '2024-11-11'
  },
  {
    id: 11,
    title: 'HTML & CSS Basics',
    description: 'Free introduction to web development with HTML and CSS',
    students: 567,
    lessons: 15,
    price: 0,
    revenue: 0,
    rating: 4.2,
    status: 'Active',
    type: 'Free',
    category: 'Web Development',
    color: '#2563EB',
    createdAt: '2023-12-01',
    updatedAt: '2024-09-15'
  },
  {
    id: 12,
    title: 'Machine Learning A-Z',
    description: 'Complete machine learning course with Python and real projects',
    students: 145,
    lessons: 65,
    price: 349,
    revenue: 5060,
    rating: 4.9,
    status: 'Archived',
    type: 'Paid',
    category: 'Machine Learning',
    color: '#7C3AED',
    createdAt: '2023-06-10',
    updatedAt: '2024-03-15'
  }
];

// Render course cards into the grid
function renderCourseCards(courses = mockCourses) {
  const grid = document.getElementById('coursesGrid');
  if (!grid) return;
  
  if (courses.length === 0) {
    grid.innerHTML = '<p class="no-results">No courses found.</p>';
    return;
  }

  grid.innerHTML = courses.map(course => `
    <div class="course-card-figma">
      <div class="course-card-thumbnail">
        <img src="${course.image}" alt="${course.title}">
        <span class="course-card-status ${course.status.toLowerCase()}">${course.status}</span>
      </div>
      <div class="course-card-content">
        <span class="course-card-category">${course.category}</span>
        <h4 class="course-card-title">${course.title}</h4>
        <div class="course-card-meta">
          <span>${course.lessons} lessons</span>
          <span>${course.hours} hours</span>
          <span>${course.students} students</span>
        </div>
        <div class="course-card-footer">
          <span class="course-card-price">${course.price}</span>
          <div class="course-card-actions">
            <button class="action-btn-icon" onclick="viewCourse(${course.id})">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </button>
            <button class="action-btn-icon" onclick="editCourse(${course.id})">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            </button>
            <button class="action-btn-icon delete" onclick="deleteCourse(${course.id})">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

// Placeholder functions for course actions
window.viewCourse = (id) => alert(`Viewing course ${id}`);
window.editCourse = (id) => alert(`Editing course ${id}`);
window.deleteCourse = (id) => confirm(`Are you sure you want to delete course ${id}?`);

// Filtering and Sorting Logic
window.filterCourses = () => {
  const searchInput = document.querySelector('.search-bar input').value.toLowerCase();
  const categoryFilter = document.querySelectorAll('.filter-select')[0].value;
  const statusFilter = document.querySelectorAll('.filter-select')[1].value;

  let filtered = mockCourses.filter(course => {
    const matchesSearch = course.title.toLowerCase().includes(searchInput);
    const matchesCategory = !categoryFilter || course.category === categoryFilter;
    const matchesStatus = !statusFilter || course.status === statusFilter;
    return matchesSearch && matchesCategory && matchesStatus;
  });
  
  renderCourseCards(filtered);
};

window.sortCourses = (event) => {
  const sortBy = event.target.value;
  let sorted = [...mockCourses]; // Use a copy
  
  switch(sortBy) {
    case 'oldest':
      sorted.sort((a, b) => a.id - b.id);
      break;
    case 'title':
      sorted.sort((a, b) => a.title.localeCompare(b.title));
      break;
    case 'newest':
    default:
       sorted.sort((a, b) => b.id - a.id);
      break;
  }
  
  // Re-apply filters after sorting
  const searchInput = document.querySelector('.search-bar input').value.toLowerCase();
  const categoryFilter = document.querySelectorAll('.filter-select')[0].value;
  const statusFilter = document.querySelectorAll('.filter-select')[1].value;

  let filteredAndSorted = sorted.filter(course => {
    const matchesSearch = course.title.toLowerCase().includes(searchInput);
    const matchesCategory = !categoryFilter || course.category === categoryFilter;
    const matchesStatus = !statusFilter || course.status === statusFilter;
    return matchesSearch && matchesCategory && matchesStatus;
  });

  renderCourseCards(filteredAndSorted);
};


// Open Finance Page
window.openFinancePage = function() {
  const userData = store.getState().user;

  // Preserve sidebar menu state
  const generalChildren = document.getElementById('general-children');
  const isGeneralExpanded = generalChildren && !generalChildren.classList.contains('hidden');
  const contentChildren = document.getElementById('content-children');
  const isContentExpanded = contentChildren && !contentChildren.classList.contains('hidden');

  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Finance</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn">üí° Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isGeneralExpanded ? 'expanded' : ''}" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">${isGeneralExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isGeneralExpanded ? '' : 'hidden'}" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
            </div>
          </div>

          <!-- Content Management -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isContentExpanded ? 'expanded' : ''}" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">${isContentExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isContentExpanded ? '' : 'hidden'}" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openCreateCourse()">Create Course</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMyCourses()">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft')">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived')">Archived</a>
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event)">Finance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openAssignmentsPage()">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link" onclick="openAIAssistantPage(); return false;">AI Assistant</a>
            </div>
          </div>

          <!-- Analytics -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Analytics</a>
            </div>
          </div>

          <!-- Rolls -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Rolls</a>
            </div>
          </div>

          <!-- Settings -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Settings</a>
            </div>
          </div>

          <!-- My Subscription -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- Finance Content -->
        <div class="figma-content-area finance-page">
          <style>
            .figma-content-area.finance-page {
              padding: 24px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 20px !important;
            }
            .figma-content-area.finance-page .finance-stats-grid {
              display: grid !important;
              grid-template-columns: repeat(4, 1fr) !important;
              gap: 16px !important;
              margin-bottom: 0 !important;
            }
            .figma-content-area.finance-page .finance-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 20px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 8px !important;
              transition: all 0.3s ease !important;
              cursor: pointer !important;
            }
            .figma-content-area.finance-page .finance-card:hover {
              transform: translateY(-5px) !important;
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
              box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
            }
            .figma-content-area.finance-page .finance-card-title {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              margin: 0 !important;
            }
            .figma-content-area.finance-page .finance-card-amount {
              color: #ffffff !important;
              font-size: 32px !important;
              font-weight: 700 !important;
              margin: 6px 0 !important;
              line-height: 1.1 !important;
            }
            .figma-content-area.finance-page .finance-card-subtitle {
              color: #10b981 !important;
              font-size: 12px !important;
              font-weight: 400 !important;
              margin: 0 !important;
            }
            .figma-content-area.finance-page .finance-section {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 24px !important;
              transition: all 0.3s ease !important;
            }
            .figma-content-area.finance-page .section-title {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 18px !important;
              font-weight: 600 !important;
              margin: 0 0 20px 0 !important;
            }
            .figma-content-area.finance-page .payment-method-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              padding: 16px !important;
              margin-bottom: 16px !important;
              transition: all 0.3s ease !important;
              position: relative !important;
              cursor: pointer !important;
              overflow: hidden !important;
            }
            .figma-content-area.finance-page .payment-method-card:hover {
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
              transform: translateY(-3px) !important;
              box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3) !important;
            }
            .figma-content-area.finance-page .payment-method-card:hover .card-actions-overlay {
              opacity: 1 !important;
              transform: translateY(0) !important;
            }
            .figma-content-area.finance-page .card-actions-overlay {
              position: absolute !important;
              top: 0 !important;
              left: 0 !important;
              right: 0 !important;
              bottom: 0 !important;
              background: rgba(0, 0, 0, 0.8) !important;
              display: flex !important;
              justify-content: center !important;
              align-items: center !important;
              gap: 12px !important;
              opacity: 0 !important;
              transform: translateY(10px) !important;
              transition: all 0.3s ease !important;
            }
            .figma-content-area.finance-page .card-action-btn {
              background: rgba(126, 162, 212, 0.2) !important;
              border: 1px solid rgba(126, 162, 212, 0.4) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 8px 16px !important;
              border-radius: 8px !important;
              cursor: pointer !important;
              font-size: 12px !important;
              font-weight: 600 !important;
              transition: all 0.3s ease !important;
            }
            .figma-content-area.finance-page .card-action-btn.edit-btn:hover {
              background: rgba(126, 162, 212, 0.3) !important;
            }
            .figma-content-area.finance-page .card-action-btn.delete-btn {
              background: rgba(239, 68, 68, 0.2) !important;
              border-color: rgba(239, 68, 68, 0.4) !important;
              color: #ef4444 !important;
            }
            .figma-content-area.finance-page .card-action-btn.delete-btn:hover {
              background: rgba(239, 68, 68, 0.3) !important;
            }
            .figma-content-area.finance-page .section-header {
              display: flex !important;
              justify-content: space-between !important;
              align-items: flex-start !important;
              margin-bottom: 20px !important;
              flex-wrap: wrap !important;
              gap: 16px !important;
            }
            .figma-content-area.finance-page .transaction-controls {
              display: flex !important;
              gap: 12px !important;
              flex-wrap: wrap !important;
              align-items: center !important;
            }
            .figma-content-area.finance-page .transaction-search,
            .figma-content-area.finance-page .transaction-date-filter,
            .figma-content-area.finance-page .transaction-type-filter {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              padding: 8px 12px !important;
              color: #ffffff !important;
              font-size: 14px !important;
              transition: all 0.3s ease !important;
            }
            .figma-content-area.finance-page .transaction-search {
              min-width: 200px !important;
            }
            .figma-content-area.finance-page .transaction-search:focus,
            .figma-content-area.finance-page .transaction-date-filter:focus,
            .figma-content-area.finance-page .transaction-type-filter:focus {
              border-color: rgba(126, 162, 212, 0.4) !important;
              outline: none !important;
              background: rgba(58, 56, 56, 0.5) !important;
            }
            .figma-content-area.finance-page .payment-card-content {
              display: flex !important;
              justify-content: space-between !important;
              align-items: center !important;
            }
            .figma-content-area.finance-page .payment-card-name {
              color: #ffffff !important;
              font-size: 16px !important;
              font-weight: 600 !important;
              margin-bottom: 4px !important;
            }
            .figma-content-area.finance-page .payment-card-number {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
            }
            .figma-content-area.finance-page .payment-card-badge {
              background: #10b981 !important;
              color: #ffffff !important;
              padding: 6px 12px !important;
              border-radius: 16px !important;
              font-size: 12px !important;
              font-weight: 600 !important;
            }
            .figma-content-area.finance-page .add-payment-btn {
              background: transparent !important;
              border: 1px solid rgba(126, 162, 212, 0.5) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 12px 16px !important;
              border-radius: 8px !important;
              font-size: 14px !important;
              cursor: pointer !important;
              transition: all 0.2s !important;
            }
            .figma-content-area.finance-page .finance-transactions-table {
              width: 100% !important;
              border-collapse: collapse !important;
            }
            .figma-content-area.finance-page .finance-transactions-table th {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              font-weight: 600 !important;
              text-align: left !important;
              padding: 12px !important;
              border-bottom: 1px solid rgba(126, 162, 212, 0.2) !important;
            }
            .figma-content-area.finance-page .finance-transactions-table td {
              color: #ffffff !important;
              font-size: 14px !important;
              padding: 12px !important;
              border-bottom: 1px solid rgba(126, 162, 212, 0.1) !important;
            }
            .figma-content-area.finance-page .status-completed {
              background: rgba(16, 185, 129, 0.2) !important;
              color: #10b981 !important;
              padding: 4px 10px !important;
              border-radius: 12px !important;
              font-size: 12px !important;
              font-weight: 500 !important;
            }
            .figma-content-area.finance-page .promo-code-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              padding: 16px !important;
              margin-bottom: 16px !important;
              transition: all 0.3s ease !important;
            }
            .figma-content-area.finance-page .promo-code-content {
              display: flex !important;
              justify-content: space-between !important;
              align-items: flex-start !important;
            }
            .figma-content-area.finance-page .promo-code-name {
              color: #ffffff !important;
              font-size: 16px !important;
              font-weight: 700 !important;
              margin-bottom: 4px !important;
            }
            .figma-content-area.finance-page .promo-code-description {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 12px !important;
              margin-bottom: 2px !important;
            }
            .figma-content-area.finance-page .promo-code-usage {
              color: rgba(107, 114, 128, 1) !important;
              font-size: 11px !important;
            }
            .figma-content-area.finance-page .promo-edit-btn {
              background: rgba(126, 162, 212, 0.2) !important;
              border: 1px solid rgba(126, 162, 212, 0.4) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 8px 16px !important;
              border-radius: 8px !important;
              font-size: 12px !important;
              font-weight: 600 !important;
              cursor: pointer !important;
            }
            .figma-content-area.finance-page .add-promo-btn {
              background: transparent !important;
              border: 1px solid rgba(126, 162, 212, 0.5) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 12px 16px !important;
              border-radius: 8px !important;
              font-size: 14px !important;
              cursor: pointer !important;
            }
            @media (max-width: 1200px) {
              .figma-content-area.finance-page .finance-stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
              }
            }
            @media (max-width: 768px) {
              .figma-content-area.finance-page .finance-stats-grid {
                grid-template-columns: 1fr !important;
              }
            }
          </style>
          <!-- Finance Stats Cards -->
          <div class="finance-stats-grid">
            <div class="finance-card" onclick="showFinanceDetails('revenue')">
              <div class="finance-card-header">
                <h3 class="finance-card-title">Total revenue</h3>
              </div>
              <div class="finance-card-amount">$12,450</div>
              <div class="finance-card-subtitle">+ $1,200 this month</div>
            </div>
            <div class="finance-card" onclick="showFinanceDetails('month')">
              <div class="finance-card-header">
                <h3 class="finance-card-title">This month</h3>
              </div>
              <div class="finance-card-amount">$2,845</div>
              <div class="finance-card-subtitle">+ $1,200 this month</div>
            </div>
            <div class="finance-card" onclick="showFinanceDetails('balance')">
              <div class="finance-card-header">
                <h3 class="finance-card-title">Available balance</h3>
              </div>
              <div class="finance-card-amount">$1,250</div>
              <div class="finance-card-subtitle">Ready to withdraw</div>
            </div>
            <div class="finance-card" onclick="showFinanceDetails('referral')">
              <div class="finance-card-header">
                <h3 class="finance-card-title">Referral Earnings</h3>
              </div>
              <div class="finance-card-amount">$485</div>
              <div class="finance-card-subtitle">From 12 referrals</div>
            </div>
          </div>

          <!-- Payment Methods Section -->
          <div class="finance-section payment-methods-section">
            <div class="section-header">
              <h3 class="section-title">Payment methods</h3>
            </div>
            <div class="payment-method-card" onclick="manageCard()">
              <div class="payment-card-content">
                <div class="payment-card-info">
                  <div class="payment-card-name">UzBank Card</div>
                  <div class="payment-card-number">**** **** **** 1234</div>
                </div>
                <div class="payment-card-badge">Primary</div>
              </div>
              <div class="card-actions-overlay">
                <button class="card-action-btn edit-btn" onclick="event.stopPropagation(); editCard()">Edit</button>
                <button class="card-action-btn delete-btn" onclick="event.stopPropagation(); deleteCard()">Delete</button>
              </div>
            </div>
            <button class="add-payment-btn" onclick="addPaymentMethod()">+ Add a payment method</button>
          </div>

          <!-- Recent Transactions Section -->
          <div class="finance-section transactions-section">
            <div class="section-header">
              <h3 class="section-title">Recent transactions</h3>
              <div class="transaction-controls">
                <input type="text" placeholder="Search transactions..." class="transaction-search" oninput="filterTransactions()">
                <input type="date" class="transaction-date-filter" onchange="filterTransactions()">
                <select class="transaction-type-filter" onchange="filterTransactions()">
                  <option value="">All Types</option>
                  <option value="Sale">Sales</option>
                  <option value="Payout">Payouts</option>
                  <option value="Refund">Refunds</option>
                </select>
              </div>
            </div>
            <div class="transactions-table-wrapper">
              <table class="finance-transactions-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Course</th>
                    <th>Student</th>
                    <th>Method</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Oct 10, 2025</td>
                    <td>React Masterclass</td>
                    <td>John Smith</td>
                    <td>Uzum</td>
                    <td>$150</td>
                    <td><span class="status-completed">Completed</span></td>
                  </tr>
                  <tr>
                    <td>Oct 9, 2025</td>
                    <td>UI/UX Design</td>
                    <td>Sarah Connor</td>
                    <td>Uzum</td>
                    <td>$200</td>
                    <td><span class="status-completed">Completed</span></td>
                  </tr>
                  <tr>
                    <td>Oct 8, 2025</td>
                    <td>JavaScript</td>
                    <td>Mike Johnson</td>
                    <td>Uzum</td>
                    <td>$135</td>
                    <td><span class="status-completed">Completed</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Promo Codes Section -->
          <div class="finance-section promo-section">
            <div class="section-header">
              <h3 class="section-title">Promo Codes</h3>
            </div>
            <div class="promo-code-card">
              <div class="promo-code-content">
                <div class="promo-code-info">
                  <div class="promo-code-name">NEWSTUDENT30</div>
                  <div class="promo-code-description">30% discount for new students</div>
                  <div class="promo-code-usage">Used: 45 times ¬∑ Expires: Dec 31, 2025</div>
                </div>
                <button class="promo-edit-btn">Edit</button>
              </div>
            </div>
            <button class="add-promo-btn">+ Create a new Promo Code</button>
          </div>
        </div>
      </div>
    </div>
  `;
};

// Open AI Assistant Page
function openAIAssistantPage() {
  console.log('Opening AI Assistant Page');

  try {
    // Update page title
    const titleElement = document.querySelector('.figma-title h2');
    const contentArea = document.querySelector('.figma-content-area');

    if (titleElement) {
      titleElement.textContent = 'AI Assistant';
    }

    if (contentArea) {
      contentArea.className = 'figma-content-area ai-assistant-page';
      contentArea.innerHTML = `
        <div class="ai-assistant-container">
          <style>
            .figma-content-area.ai-assistant-page {
              background: #1a1a1a !important;
              padding: 24px !important;
              overflow-y: auto !important;
            }
            .ai-assistant-container {
              max-width: 900px !important;
              margin: 0 auto !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 20px !important;
            }
            .ai-status-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 24px !important;
              display: flex !important;
              align-items: center !important;
              gap: 16px !important;
            }
            .ai-icon {
              width: 48px !important;
              height: 48px !important;
              background: rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              font-size: 24px !important;
            }
            .ai-status-content h3 {
              color: #ffffff !important;
              font-size: 24px !important;
              font-weight: 600 !important;
              margin: 0 0 8px 0 !important;
            }
            .ai-status-content p {
              color: rgba(156, 163, 175, 1) !important;
              margin: 0 !important;
              font-size: 16px !important;
            }
            .ai-metrics {
              display: grid !important;
              grid-template-columns: repeat(2, 1fr) !important;
              gap: 20px !important;
            }
            .ai-metric-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 24px !important;
              text-align: center !important;
              cursor: pointer !important;
              transition: all 0.3s ease !important;
            }
            .ai-metric-card:hover {
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
              transform: translateY(-5px) !important;
              box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
            }
            .ai-metric-card h4 {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              margin: 0 0 12px 0 !important;
              text-transform: uppercase !important;
              letter-spacing: 0.5px !important;
            }
            .ai-metric-value {
              color: #ffffff !important;
              font-size: 36px !important;
              font-weight: 700 !important;
              margin: 0 0 8px 0 !important;
            }
            .ai-metric-change {
              color: #22c55e !important;
              font-size: 14px !important;
              font-weight: 500 !important;
            }
            .ai-personality-section,
            .ai-auto-response-section,
            .ai-responses-section {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 20px !important;
            }
            .section-title {
              color: #ffffff !important;
              font-size: 20px !important;
              font-weight: 600 !important;
              margin: 0 0 16px 0 !important;
            }
            .form-group {
              margin-bottom: 16px !important;
            }
            .form-group:last-child {
              margin-bottom: 0 !important;
            }
            .form-label {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              margin-bottom: 8px !important;
              display: block !important;
            }
            .form-input,
            .form-textarea {
              width: 100% !important;
              padding: 12px !important;
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              color: #ffffff !important;
              font-size: 14px !important;
              transition: all 0.3s ease !important;
            }
            .form-textarea {
              resize: vertical !important;
              min-height: 100px !important;
            }
            .form-input:focus,
            .form-textarea:focus {
              outline: none !important;
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
            }
            .settings-item {
              display: flex !important;
              align-items: flex-start !important;
              justify-content: space-between !important;
              padding: 16px !important;
              background: rgba(45, 45, 50, 0.3) !important;
              border: 1px solid rgba(75, 85, 99, 0.2) !important;
              border-radius: 8px !important;
              transition: all 0.3s ease !important;
            }
            .settings-item:hover {
              background: rgba(45, 45, 50, 0.5) !important;
            }
            .setting-left {
              flex: 1 !important;
              margin-right: 16px !important;
            }
            .setting-title {
              color: #ffffff !important;
              font-size: 16px !important;
              font-weight: 600 !important;
              margin-bottom: 4px !important;
              line-height: 1.2 !important;
            }
            .setting-description {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              line-height: 1.4 !important;
            }
            .setting-toggle {
              display: flex !important;
              align-items: flex-start !important;
            }
            .toggle-switch-new {
              position: relative !important;
              display: inline-block !important;
              width: 44px !important;
              height: 24px !important;
              background-color: rgba(75, 85, 99, 0.6) !important;
              border-radius: 12px !important;
              cursor: pointer !important;
              transition: background-color 0.3s ease !important;
            }
            .toggle-switch-new input {
              position: absolute !important;
              opacity: 0 !important;
              width: 0 !important;
              height: 0 !important;
            }
            .toggle-switch-new .toggle-thumb {
              position: absolute !important;
              top: 2px !important;
              left: 2px !important;
              width: 20px !important;
              height: 20px !important;
              background-color: white !important;
              border-radius: 50% !important;
              transition: transform 0.3s ease !important;
              box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
            }
            .toggle-switch-new input:checked ~ .toggle-thumb {
              transform: translateX(20px) !important;
            }
            .toggle-switch-new input:checked {
              background-color: #3b82f6 !important;
            }
            .toggle-switch-new:has(input:checked) {
              background-color: #3b82f6 !important;
            }
            .response-item {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              padding: 16px !important;
              margin-bottom: 12px !important;
              transition: all 0.3s ease !important;
            }
            .response-item:last-child {
              margin-bottom: 0 !important;
            }
            .response-item:hover {
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
            }
            .response-header {
              display: flex !important;
              justify-content: space-between !important;
              align-items: flex-start !important;
              margin-bottom: 16px !important;
            }
            .response-user {
              display: flex !important;
              align-items: center !important;
              gap: 8px !important;
            }
            .user-avatar {
              width: 32px !important;
              height: 32px !important;
              background: rgba(126, 162, 212, 0.3) !important;
              border-radius: 50% !important;
              display: flex !important;
              align-items: center !important;
              justify-content: center !important;
              font-size: 14px !important;
              color: rgba(126, 162, 212, 1) !important;
            }
            .user-info h6 {
              color: #ffffff !important;
              font-size: 14px !important;
              font-weight: 600 !important;
              margin: 0 !important;
            }
            .user-info span {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 12px !important;
            }
            .edit-btn {
              background: rgba(126, 162, 212, 0.2) !important;
              border: 1px solid rgba(126, 162, 212, 0.4) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 6px 12px !important;
              border-radius: 6px !important;
              font-size: 12px !important;
              font-weight: 600 !important;
              cursor: pointer !important;
              transition: all 0.3s ease !important;
            }
            .edit-btn:hover {
              background: rgba(126, 162, 212, 0.3) !important;
            }
            .question-text,
            .response-text {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              margin: 0 0 12px 0 !important;
            }
            .ai-response-text {
              color: #ffffff !important;
              font-size: 14px !important;
              line-height: 1.6 !important;
              margin: 0 !important;
            }
            @media (max-width: 768px) {
              .ai-metrics {
                grid-template-columns: 1fr !important;
              }
              .figma-content-area.ai-assistant-page {
                padding: 16px !important;
              }
            }
          </style>

          <!-- AI Status Card -->
          <div class="ai-status-card">
            <div class="ai-icon">ü§ñ</div>
            <div class="ai-status-content">
              <h3>AI Assistant Status</h3>
              <p>‚Ä¢ 156 questions answered today</p>
            </div>
          </div>

          <!-- AI Metrics -->
          <div class="ai-metrics">
            <div class="ai-metric-card" onclick="showAIMetrics('responses')">
              <h4>Total AI Responses</h4>
              <div class="ai-metric-value">2,847</div>
              <div class="ai-metric-change">‚Üë 23% this month</div>
            </div>
            <div class="ai-metric-card" onclick="showAIMetrics('time')">
              <h4>Response Time</h4>
              <div class="ai-metric-value">1.2s</div>
              <div class="ai-metric-change">Lightning fast</div>
            </div>
          </div>

          <!-- AI Personality Section -->
          <div class="ai-personality-section">
            <h3 class="section-title">AI Personality</h3>
            <div class="form-group">
              <label class="form-label">AI Name</label>
              <input type="text" class="form-input" value="John's AI Helper" placeholder="Enter AI assistant name">
            </div>
            <div class="form-group">
              <label class="form-label">AI Instructions</label>
              <textarea class="form-textarea" placeholder="Describe how the AI should behave...">You are a helpful teaching assistant. Always encourage students and provide clear examples.</textarea>
            </div>
          </div>

          <!-- Auto-Response Settings -->
          <div class="ai-auto-response-section">
            <h3 class="section-title">AI Auto-Response Settings</h3>
            <p style="color: rgba(156, 163, 175, 1); margin-bottom: 16px; font-size: 14px;">Control where and when AI can automatically respond to students</p>

            <div class="settings-item">
              <div class="setting-left">
                <div class="setting-title">Answer Lesson Comments</div>
                <div class="setting-description">AI will respond to student questions in lesson comment sections</div>
              </div>
              <div class="setting-toggle">
                <label class="toggle-switch-new">
                  <input type="checkbox" checked onchange="toggleAISetting(this)">
                  <div class="toggle-thumb"></div>
                </label>
              </div>
            </div>
          </div>

          <!-- Recent AI Responses -->
          <div class="ai-responses-section">
            <h3 class="section-title">Recent AI Responses</h3>

            <div class="response-item">
              <div class="response-header">
                <div class="response-user">
                  <div class="user-avatar">AJ</div>
                  <div class="user-info">
                    <h6>Alex Johnson</h6>
                    <span>React Hooks lesson ‚Ä¢ 2 min ago</span>
                  </div>
                </div>
                <button class="edit-btn" onclick="editAIResponse(1)">Edit</button>
              </div>
              <div class="response-content">
                <p class="question-text"><strong>Question:</strong><br>"What's the difference between useState and useEffect?"</p>
                <p class="response-text"><strong>AI Response:</strong><br>useState manages component state, while useEffect handles side effects like API calls. Check Lesson 5 for examples!</p>
              </div>
            </div>

            <div class="response-item">
              <div class="response-header">
                <div class="response-user">
                  <div class="user-avatar">AJ</div>
                  <div class="user-info">
                    <h6>Alex Johnson</h6>
                    <span>React Hooks lesson ‚Ä¢ 2 min ago</span>
                  </div>
                </div>
                <button class="edit-btn" onclick="editAIResponse(2)">Edit</button>
              </div>
              <div class="response-content">
                <p class="question-text"><strong>Question:</strong><br>"What's the difference between useState and useEffect?"</p>
                <p class="response-text"><strong>AI Response:</strong><br>useState manages component state, while useEffect handles side effects like API calls. Check Lesson 5 for examples!</p>
              </div>
            </div>
          </div>
        </div>
  `;
    } else {
      console.error('Content area not found');
    }
  } catch (error) {
    console.error('Error opening AI Assistant page:', error);
  }
};

// Open Assignments Page
window.openAssignmentsPage = function() {
  const userData = store.getState().user;

  // Preserve sidebar menu state
  const generalChildren = document.getElementById('general-children');
  const isGeneralExpanded = generalChildren && !generalChildren.classList.contains('hidden');
  const contentChildren = document.getElementById('content-children');
  const isContentExpanded = contentChildren && !contentChildren.classList.contains('hidden');

  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Assignments</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="backToDashboard()">‚Üê Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isGeneralExpanded ? 'expanded' : ''}" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">${isGeneralExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isGeneralExpanded ? '' : 'hidden'}" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
            </div>
          </div>

          <!-- Content Management -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isContentExpanded ? 'expanded' : ''}" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">${isContentExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isContentExpanded ? '' : 'hidden'}" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openCreateCourse()">Create Course</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMyCourses()">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft')">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived')">Archived</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openFinancePage()">Finance</a>
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event)">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link" onclick="openAIAssistantPage(); return false;">AI Assistant</a>
            </div>
          </div>

          <!-- Analytics -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Analytics</a>
            </div>
          </div>

          <!-- Rolls -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Rolls</a>
            </div>
          </div>

          <!-- Settings -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Settings</a>
            </div>
          </div>

          <!-- My Subscription -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- Assignments Content -->
        <div class="figma-content-area assignments-page">
          <style>
            .figma-content-area.assignments-page {
              padding: 24px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 20px !important;
            }
            .assignments-stats-grid {
              display: grid !important;
              grid-template-columns: repeat(4, 1fr) !important;
              gap: 16px !important;
              margin-bottom: 0 !important;
            }
            .assignments-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 20px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 8px !important;
              transition: all 0.3s ease !important;
              cursor: pointer !important;
            }
            .assignments-card:hover {
              transform: translateY(-5px) !important;
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.5) !important;
              box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
            }
            .assignments-card-title {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              margin: 0 !important;
            }
            .assignments-card-amount {
              color: #ffffff !important;
              font-size: 32px !important;
              font-weight: 700 !important;
              margin: 4px 0 !important;
            }
            .assignment-tabs {
              display: flex !important;
              gap: 0 !important;
              margin-bottom: 20px !important;
            }
            .assignment-tab {
              background: rgba(58, 56, 56, 0.3) !important;
              color: rgba(156, 163, 175, 1) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              padding: 12px 24px !important;
              cursor: pointer !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              transition: all 0.3s ease !important;
            }
            .assignment-tab:first-child {
              border-radius: 8px 0 0 8px !important;
            }
            .assignment-tab:last-child {
              border-radius: 0 8px 8px 0 !important;
              border-left: none !important;
            }
            .assignment-tab.active {
              background: rgba(126, 162, 212, 0.2) !important;
              color: rgba(126, 162, 212, 1) !important;
            }
            .assignments-section {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 24px !important;
            }
            .assignments-section-title {
              color: rgba(126, 162, 212, 1) !important;
              font-size: 18px !important;
              font-weight: 600 !important;
              margin: 0 0 20px 0 !important;
            }
            .assignment-item {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 8px !important;
              padding: 20px !important;
              margin-bottom: 16px !important;
              transition: all 0.3s ease !important;
              cursor: pointer !important;
            }
            .assignment-item:hover {
              border-color: rgba(126, 162, 212, 0.4) !important;
              background: rgba(58, 56, 56, 0.4) !important;
              transform: translateX(5px) !important;
            }
            .assignment-header {
              display: flex !important;
              justify-content: space-between !important;
              align-items: flex-start !important;
              margin-bottom: 12px !important;
            }
            .assignment-title {
              color: #ffffff !important;
              font-size: 16px !important;
              font-weight: 600 !important;
              margin: 0 0 4px 0 !important;
            }
            .assignment-meta {
              font-size: 12px !important;
              color: rgba(156, 163, 175, 1) !important;
            }
            .assignment-status {
              background: rgba(249, 115, 22, 0.2) !important;
              color: #f97316 !important;
              padding: 4px 12px !important;
              border-radius: 12px !important;
              font-size: 12px !important;
              font-weight: 500 !important;
            }
            .assignment-description {
              color: rgba(255, 255, 255, 0.8) !important;
              font-size: 14px !important;
              margin-bottom: 16px !important;
            }
            .assignment-action {
              align-self: flex-end !important;
            }
            .grade-btn {
              background: rgba(126, 162, 212, 0.2) !important;
              border: 1px solid rgba(126, 162, 212, 0.4) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 8px 16px !important;
              border-radius: 8px !important;
              font-size: 12px !important;
              font-weight: 600 !important;
              cursor: pointer !important;
              transition: all 0.3s ease !important;
            }
            .grade-btn:hover {
              background: rgba(126, 162, 212, 0.3) !important;
            }
            @media (max-width: 1200px) {
              .assignments-stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
              }
            }
            @media (max-width: 768px) {
              .assignments-stats-grid {
                grid-template-columns: 1fr !important;
              }
              .figma-content-area.assignments-page {
                padding: 16px !important;
              }
            }
          </style>

          <!-- Assignment Statistics Cards -->
          <div class="assignments-stats-grid">
            <div class="assignments-card" onclick="showAssignmentDetails('total')">
              <h3 class="assignments-card-title">Total assignments</h3>
              <div class="assignments-card-amount">235</div>
            </div>
            <div class="assignments-card" onclick="showAssignmentDetails('pending')">
              <h3 class="assignments-card-title">Pending Review</h3>
              <div class="assignments-card-amount">15</div>
            </div>
            <div class="assignments-card" onclick="showAssignmentDetails('graded')">
              <h3 class="assignments-card-title">Graded</h3>
              <div class="assignments-card-amount">220</div>
            </div>
            <div class="assignments-card" onclick="showAssignmentDetails('grade')">
              <h3 class="assignments-card-title">Average grade</h3>
              <div class="assignments-card-amount">80%</div>
            </div>
          </div>

          <!-- Assignment Filter Tabs -->
          <div class="assignment-tabs">
            <div class="assignment-tab active" onclick="switchAssignmentTab(this, 'pending')">Pending</div>
            <div class="assignment-tab" onclick="switchAssignmentTab(this, 'graded')">Graded</div>
          </div>

          <!-- Assignments Section -->
          <div class="assignments-section">
            <h3 class="assignments-section-title">Pending assignments</h3>

            <!-- Assignment Items -->
            <div class="assignment-item">
              <div class="assignment-header">
                <div>
                  <h4 class="assignment-title">Build a Todo App Project</h4>
                  <div class="assignment-meta">Submitted: Oct 10, 2025 ‚Ä¢ React Masterclass</div>
                </div>
                <span class="assignment-status">Pending</span>
              </div>
              <div class="assignment-description">
                Submission: Complete Todo application with add, delete, and edit functionality
              </div>
              <div class="assignment-action">
                <button class="grade-btn" onclick="gradeAssignment(1)">Grade now</button>
              </div>
            </div>

            <div class="assignment-item">
              <div class="assignment-header">
                <div>
                  <h4 class="assignment-title">Build a Todo App Project</h4>
                  <div class="assignment-meta">Submitted: Oct 10, 2025 ‚Ä¢ React Masterclass</div>
                </div>
                <span class="assignment-status">Pending</span>
              </div>
              <div class="assignment-description">
                Submission: Complete Todo application with add, delete, and edit functionality
              </div>
              <div class="assignment-action">
                <button class="grade-btn" onclick="gradeAssignment(2)">Grade now</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
};

// Assignment Interactive Functions
window.showAssignmentDetails = function(cardType) {
  const details = {
    total: {
      title: 'Total Assignments Overview',
      content: `
        <div class="modal-content">
          <h3>Assignment Statistics</h3>
          <div class="assignment-breakdown">
            <div class="breakdown-item">
              <span>This Month:</span>
              <span>45 assignments</span>
            </div>
            <div class="breakdown-item">
              <span>This Week:</span>
              <span>12 assignments</span>
            </div>
            <div class="breakdown-item">
              <span>Today:</span>
              <span>3 assignments</span>
            </div>
            <div class="breakdown-total">
              <span>Total All Time:</span>
              <span>235 assignments</span>
            </div>
          </div>
        </div>
      `
    },
    pending: {
      title: 'Pending Assignments Details',
      content: `
        <div class="modal-content">
          <h3>Review Queue</h3>
          <div class="pending-stats">
            <div class="stat-item">
              <span>Submitted Today:</span>
              <span>5</span>
            </div>
            <div class="stat-item">
              <span>Overdue Reviews:</span>
              <span>3</span>
            </div>
            <div class="stat-item">
              <span>Average Wait Time:</span>
              <span>2.5 days</span>
            </div>
          </div>
          <button class="review-all-btn" onclick="reviewAllAssignments()">Start Review Session</button>
        </div>
      `
    },
    graded: {
      title: 'Graded Assignments',
      content: `
        <div class="modal-content">
          <h3>Grading Summary</h3>
          <div class="graded-stats">
            <div class="stat-item">
              <span>A Grade (90-100%):</span>
              <span>85 assignments</span>
            </div>
            <div class="stat-item">
              <span>B Grade (80-89%):</span>
              <span>90 assignments</span>
            </div>
            <div class="stat-item">
              <span>C Grade (70-79%):</span>
              <span>35 assignments</span>
            </div>
            <div class="stat-item">
              <span>Below 70%:</span>
              <span>10 assignments</span>
            </div>
          </div>
        </div>
      `
    },
    grade: {
      title: 'Grade Analysis',
      content: `
        <div class="modal-content">
          <h3>Grade Distribution</h3>
          <div class="grade-analysis">
            <div class="grade-bar">
              <span>Average Grade: 80%</span>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 80%"></div>
              </div>
            </div>
            <div class="grade-trends">
              <div class="trend-item">
                <span>Trend:</span>
                <span style="color: #22c55e;">‚Üó +2.5% this month</span>
              </div>
              <div class="trend-item">
                <span>Best Course:</span>
                <span>React Masterclass (85%)</span>
              </div>
            </div>
          </div>
        </div>
      `
    }
  };

  showModal(details[cardType].title, details[cardType].content);
};

window.reviewAllAssignments = function() {
  showMessage('Starting review session...', 'info');
  closeModal();
  // Switch to pending tab and highlight first assignment
  const pendingTab = document.querySelector('.assignment-tab');
  switchAssignmentTab(pendingTab, 'pending');
};

// Enhanced Assignment tab switching function
window.switchAssignmentTab = function(tabElement, tabType) {
  // Remove active class from all tabs
  document.querySelectorAll('.assignment-tab').forEach(tab => {
    tab.classList.remove('active');
  });

  // Add active class to clicked tab
  tabElement.classList.add('active');

  // Update section title and content
  const sectionTitle = document.querySelector('.assignments-section-title');
  const assignmentsSection = document.querySelector('.assignments-section');

  if (tabType === 'pending') {
    sectionTitle.textContent = 'Pending assignments';
    updateAssignmentsList('pending');
  } else {
    sectionTitle.textContent = 'Graded assignments';
    updateAssignmentsList('graded');
  }
};

// Update assignments list based on filter
window.updateAssignmentsList = function(filterType) {
  const assignmentsContainer = document.querySelector('.assignments-section');
  const existingItems = assignmentsContainer.querySelectorAll('.assignment-item');

  // Remove existing items
  existingItems.forEach(item => item.remove());

  if (filterType === 'pending') {
    // Show pending assignments
    const pendingHTML = `
      <div class="assignment-item">
        <div class="assignment-header">
          <div>
            <h4 class="assignment-title">Build a Todo App Project</h4>
            <div class="assignment-meta">Submitted: Oct 10, 2025 ‚Ä¢ React Masterclass</div>
          </div>
          <span class="assignment-status">Pending</span>
        </div>
        <div class="assignment-description">
          Submission: Complete Todo application with add, delete, and edit functionality
        </div>
        <div class="assignment-action">
          <button class="grade-btn" onclick="gradeAssignment(1)">Grade now</button>
        </div>
      </div>
      <div class="assignment-item">
        <div class="assignment-header">
          <div>
            <h4 class="assignment-title">React Router Implementation</h4>
            <div class="assignment-meta">Submitted: Oct 9, 2025 ‚Ä¢ React Advanced</div>
          </div>
          <span class="assignment-status">Pending</span>
        </div>
        <div class="assignment-description">
          Submission: Multi-page application with client-side routing
        </div>
        <div class="assignment-action">
          <button class="grade-btn" onclick="gradeAssignment(2)">Grade now</button>
        </div>
      </div>
    `;
    assignmentsContainer.insertAdjacentHTML('beforeend', pendingHTML);
  } else {
    // Show graded assignments
    const gradedHTML = `
      <div class="assignment-item">
        <div class="assignment-header">
          <div>
            <h4 class="assignment-title">JavaScript Calculator</h4>
            <div class="assignment-meta">Submitted: Oct 5, 2025 ‚Ä¢ JavaScript Basics</div>
          </div>
          <span class="assignment-status graded" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">Grade: 85%</span>
        </div>
        <div class="assignment-description">
          Well implemented calculator with all basic operations. Good code structure.
        </div>
        <div class="assignment-action">
          <button class="grade-btn" onclick="reviewGrade(3)">Review Grade</button>
        </div>
      </div>
      <div class="assignment-item">
        <div class="assignment-header">
          <div>
            <h4 class="assignment-title">CSS Grid Layout</h4>
            <div class="assignment-meta">Submitted: Oct 3, 2025 ‚Ä¢ CSS Advanced</div>
          </div>
          <span class="assignment-status graded" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">Grade: 92%</span>
        </div>
        <div class="assignment-description">
          Excellent understanding of CSS Grid. Clean and responsive design.
        </div>
        <div class="assignment-action">
          <button class="grade-btn" onclick="reviewGrade(4)">Review Grade</button>
        </div>
      </div>
    `;
    assignmentsContainer.insertAdjacentHTML('beforeend', gradedHTML);
  }
};

// Enhanced Grade assignment function
window.gradeAssignment = function(assignmentId) {
  const gradingModal = `
    <div class="modal-content">
      <h3>Grade Assignment</h3>
      <div class="grading-interface">
        <div class="assignment-details">
          <h4>Build a Todo App Project</h4>
          <p><strong>Student:</strong> John Smith</p>
          <p><strong>Course:</strong> React Masterclass</p>
          <p><strong>Submitted:</strong> Oct 10, 2025</p>
        </div>

        <div class="grading-form">
          <div class="grade-input-group">
            <label>Grade (0-100%):</label>
            <input type="number" min="0" max="100" value="85" class="grade-input" id="gradeValue" />
          </div>

          <div class="feedback-group">
            <label>Feedback:</label>
            <textarea class="feedback-textarea" placeholder="Write your feedback here..." rows="4">Good implementation of core functionality. Consider adding error handling and improving UI design.</textarea>
          </div>

          <div class="grading-actions">
            <button class="submit-grade-btn" onclick="submitGrade(${assignmentId})">Submit Grade</button>
            <button class="save-draft-btn" onclick="saveDraft(${assignmentId})">Save as Draft</button>
          </div>
        </div>
      </div>
    </div>
    <style>
      .grading-interface {
        max-height: 500px;
        overflow-y: auto;
      }
      .assignment-details {
        background: rgba(58, 56, 56, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .assignment-details h4 {
        color: rgba(126, 162, 212, 1);
        margin: 0 0 10px 0;
      }
      .grading-form .grade-input-group,
      .grading-form .feedback-group {
        margin-bottom: 20px;
      }
      .grading-form label {
        display: block;
        margin-bottom: 8px;
        color: rgba(126, 162, 212, 1);
        font-weight: 500;
      }
      .grade-input {
        width: 100px;
        padding: 10px;
        background: rgba(58, 56, 56, 0.3);
        border: 1px solid rgba(126, 162, 212, 0.2);
        border-radius: 8px;
        color: #ffffff;
        font-size: 16px;
        font-weight: bold;
      }
      .feedback-textarea {
        width: 100%;
        padding: 12px;
        background: rgba(58, 56, 56, 0.3);
        border: 1px solid rgba(126, 162, 212, 0.2);
        border-radius: 8px;
        color: #ffffff;
        font-size: 14px;
        resize: vertical;
        min-height: 100px;
      }
      .grading-actions {
        display: flex;
        gap: 12px;
      }
      .submit-grade-btn {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #22c55e;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .save-draft-btn {
        background: rgba(249, 115, 22, 0.2);
        border: 1px solid rgba(249, 115, 22, 0.4);
        color: #f97316;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .submit-grade-btn:hover {
        background: rgba(34, 197, 94, 0.3);
      }
      .save-draft-btn:hover {
        background: rgba(249, 115, 22, 0.3);
      }
    </style>
  `;

  showModal('Grade Assignment', gradingModal);
};

window.submitGrade = function(assignmentId) {
  const grade = document.getElementById('gradeValue').value;
  const feedback = document.querySelector('.feedback-textarea').value;

  showMessage(`Assignment graded successfully! Grade: ${grade}%`, 'success');
  closeModal();

  // Update assignment status
  updateAssignmentsList('pending'); // Refresh the list
};

window.saveDraft = function(assignmentId) {
  showMessage('Grade saved as draft. You can continue grading later.', 'info');
  closeModal();
};

window.reviewGrade = function(assignmentId) {
  showMessage('Opening grade review interface...', 'info');
};

const mockTransactions = [
  { date: '2025-11-02', type: 'Sale', course: 'Complete React Developer Course 2025', student: 'Ali Valiyev', amount: 49.99, status: 'Cleared' },
  { date: '2025-11-01', type: 'Sale', course: 'Advanced UI/UX Design Principles', student: 'Zarina Karimova', amount: 79.99, status: 'Cleared' },
  { date: '2025-10-30', type: 'Payout', course: '-', student: '-', amount: -2500.00, status: 'Paid' },
  { date: '2025-10-28', type: 'Sale', course: 'Node.js for Beginners', student: 'John Doe', amount: 29.99, status: 'Pending' },
  { date: '2025-10-25', type: 'Refund', course: 'Complete React Developer Course 2025', student: 'Jane Smith', amount: -49.99, status: 'Refunded' },
  { date: '2025-10-22', type: 'Sale', course: 'Introduction to Machine Learning', student: 'Peter Jones', amount: 99.99, status: 'Cleared' },
];

function renderTransactions(transactions = mockTransactions) {
  const tbody = document.getElementById('transactionsBody');
  if (!tbody) return;

  if (transactions.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" class="no-results">No transactions found.</td></tr>';
    return;
  }

  tbody.innerHTML = transactions.map(t => `
    <tr>
      <td>${t.date}</td>
      <td>${t.type}</td>
      <td>${t.course}</td>
      <td>${t.student}</td>
      <td class="amount ${t.amount > 0 ? 'positive' : 'negative'}">${t.amount.toFixed(2)}</td>
      <td><span class="status-badge ${t.status.toLowerCase()}">${t.status}</span></td>
    </tr>
  `).join('');
}

window.filterTransactions = () => {
  const searchInput = document.querySelector('.transaction-search')?.value.toLowerCase() || '';
  const dateInput = document.querySelector('.transaction-date-filter')?.value || '';
  const typeInput = document.querySelector('.transaction-type-filter')?.value || '';

  let filtered = mockTransactions.filter(t => {
    const matchesSearch = searchInput === '' ||
      t.course.toLowerCase().includes(searchInput) ||
      t.student.toLowerCase().includes(searchInput) ||
      t.type.toLowerCase().includes(searchInput);
    const matchesDate = dateInput === '' || t.date === dateInput;
    const matchesType = typeInput === '' || t.type === typeInput;

    return matchesSearch && matchesDate && matchesType;
  });

  renderTransactions(filtered);

  // Show filter results count
  const resultsCount = filtered.length;
  const totalCount = mockTransactions.length;
  if (resultsCount !== totalCount) {
    showMessage(`Showing ${resultsCount} of ${totalCount} transactions`, 'info');
  }
};

// Finance Interactive Functions
window.showFinanceDetails = function(cardType) {
  const details = {
    revenue: {
      title: 'Total Revenue Details',
      content: `
        <div class="modal-content">
          <h3>Revenue Breakdown</h3>
          <div class="revenue-chart">
            <div class="revenue-item">
              <span>Course Sales:</span>
              <span>$8,200</span>
            </div>
            <div class="revenue-item">
              <span>Subscriptions:</span>
              <span>$3,450</span>
            </div>
            <div class="revenue-item">
              <span>Referrals:</span>
              <span>$800</span>
            </div>
            <div class="revenue-total">
              <span>Total:</span>
              <span>$12,450</span>
            </div>
          </div>
        </div>
      `
    },
    month: {
      title: 'This Month Earnings',
      content: `
        <div class="modal-content">
          <h3>Monthly Performance</h3>
          <div class="monthly-stats">
            <div class="stat-item">
              <span>Week 1:</span>
              <span>$645</span>
            </div>
            <div class="stat-item">
              <span>Week 2:</span>
              <span>$780</span>
            </div>
            <div class="stat-item">
              <span>Week 3:</span>
              <span>$720</span>
            </div>
            <div class="stat-item">
              <span>Week 4:</span>
              <span>$700</span>
            </div>
          </div>
        </div>
      `
    },
    balance: {
      title: 'Available Balance',
      content: `
        <div class="modal-content">
          <h3>Withdrawal Information</h3>
          <p>Available for withdrawal: <strong>$1,250</strong></p>
          <p>Processing time: 2-3 business days</p>
          <button class="withdraw-btn" onclick="requestWithdrawal()">Request Withdrawal</button>
        </div>
      `
    },
    referral: {
      title: 'Referral Earnings',
      content: `
        <div class="modal-content">
          <h3>Referral Program</h3>
          <p>Total referred users: 12</p>
          <p>Active referrals: 8</p>
          <p>Commission rate: 10%</p>
          <p>Total earnings: <strong>$485</strong></p>
        </div>
      `
    }
  };

  showModal(details[cardType].title, details[cardType].content);
};

window.requestWithdrawal = function() {
  showMessage('Withdrawal request submitted! You will receive confirmation via email.', 'success');
  closeModal();
};

// Enhanced Finance Interactive Functions
window.manageCard = function() {
  const cardDetails = `
    <div class="modal-content">
      <h3>Card Details</h3>
      <div class="card-info-detail">
        <div class="info-row">
          <span>Card Type:</span>
          <span>UzBank Visa</span>
        </div>
        <div class="info-row">
          <span>Card Number:</span>
          <span>**** **** **** 1234</span>
        </div>
        <div class="info-row">
          <span>Cardholder:</span>
          <span>Umaraliyeva Zarnigor</span>
        </div>
        <div class="info-row">
          <span>Status:</span>
          <span class="status-active">Active</span>
        </div>
        <div class="info-row">
          <span>Expires:</span>
          <span>12/2028</span>
        </div>
      </div>
    </div>
    <style>
      .card-info-detail {
        padding: 20px 0;
      }
      .info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid rgba(126, 162, 212, 0.1);
        color: #ffffff;
      }
      .info-row:last-child {
        border-bottom: none;
      }
      .info-row span:first-child {
        color: rgba(156, 163, 175, 1);
        font-weight: 500;
      }
      .status-active {
        color: #22c55e !important;
        font-weight: 600;
      }
    </style>
  `;

  showModal('UzBank Card Details', cardDetails);
};

window.editCard = function() {
  const editForm = `
    <div class="modal-content">
      <h3>Edit Payment Method</h3>
      <div class="edit-card-form">
        <div class="form-group">
          <label>Card Nickname:</label>
          <input type="text" value="UzBank Card" class="form-input" id="cardNickname">
        </div>
        <div class="form-group">
          <label>Set as Primary:</label>
          <input type="checkbox" checked id="isPrimary">
        </div>
        <div class="form-actions">
          <button class="save-btn" onclick="saveCardChanges()">Save Changes</button>
          <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
    <style>
      .edit-card-form {
        padding: 20px 0;
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: rgba(126, 162, 212, 1);
        font-weight: 500;
      }
      .form-input {
        width: 100%;
        padding: 12px;
        background: rgba(58, 56, 56, 0.3);
        border: 1px solid rgba(126, 162, 212, 0.2);
        border-radius: 8px;
        color: #ffffff;
        font-size: 14px;
      }
      .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
      }
      .save-btn {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #22c55e;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .cancel-btn {
        background: rgba(156, 163, 175, 0.2);
        border: 1px solid rgba(156, 163, 175, 0.4);
        color: rgba(156, 163, 175, 1);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .save-btn:hover {
        background: rgba(34, 197, 94, 0.3);
      }
      .cancel-btn:hover {
        background: rgba(156, 163, 175, 0.3);
      }
    </style>
  `;

  showModal('Edit Payment Method', editForm);
};

window.deleteCard = function() {
  const confirmDialog = `
    <div class="modal-content">
      <h3>Delete Payment Method</h3>
      <div class="delete-confirmation">
        <p>Are you sure you want to delete this payment method?</p>
        <p class="warning-text">This action cannot be undone.</p>
        <div class="confirmation-actions">
          <button class="delete-confirm-btn" onclick="confirmDeleteCard()">Yes, Delete</button>
          <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
    <style>
      .delete-confirmation p {
        color: #ffffff;
        margin-bottom: 12px;
      }
      .warning-text {
        color: #ef4444 !important;
        font-weight: 500;
        margin-bottom: 24px !important;
      }
      .confirmation-actions {
        display: flex;
        gap: 12px;
      }
      .delete-confirm-btn {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #ef4444;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .delete-confirm-btn:hover {
        background: rgba(239, 68, 68, 0.3);
      }
    </style>
  `;

  showModal('Confirm Deletion', confirmDialog);
};

window.addPaymentMethod = function() {
  const addForm = `
    <div class="modal-content">
      <h3>Add Payment Method</h3>
      <div class="add-payment-form">
        <div class="form-group">
          <label>Card Number:</label>
          <input type="text" placeholder="**** **** **** ****" class="form-input" id="newCardNumber">
        </div>
        <div class="form-group">
          <label>Cardholder Name:</label>
          <input type="text" placeholder="Full name as shown on card" class="form-input" id="cardholderName">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Expiry Date:</label>
            <input type="text" placeholder="MM/YY" class="form-input" id="expiryDate">
          </div>
          <div class="form-group">
            <label>CVV:</label>
            <input type="text" placeholder="123" class="form-input" id="cvv">
          </div>
        </div>
        <div class="form-actions">
          <button class="add-card-btn" onclick="saveNewCard()">Add Card</button>
          <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>
    <style>
      .add-payment-form {
        padding: 20px 0;
      }
      .form-row {
        display: flex;
        gap: 16px;
      }
      .form-row .form-group {
        flex: 1;
      }
      .add-card-btn {
        background: rgba(126, 162, 212, 0.2);
        border: 1px solid rgba(126, 162, 212, 0.4);
        color: rgba(126, 162, 212, 1);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      }
      .add-card-btn:hover {
        background: rgba(126, 162, 212, 0.3);
      }
    </style>
  `;

  showModal('Add New Payment Method', addForm);
};

window.saveCardChanges = function() {
  showMessage('Card information updated successfully!', 'success');
  closeModal();
};

window.confirmDeleteCard = function() {
  showMessage('Payment method deleted successfully!', 'success');
  closeModal();
};

window.saveNewCard = function() {
  showMessage('New payment method added successfully!', 'success');
  closeModal();
};

// Message notification system
window.showMessage = function(message, type = 'info') {
  const messageEl = document.createElement('div');
  messageEl.className = `message-notification ${type}`;
  messageEl.textContent = message;

  const styles = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    z-index: 9999;
    transition: all 0.3s ease;
    max-width: 400px;
    word-wrap: break-word;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    transform: translateX(100%);
    opacity: 0;
  `;

  const typeStyles = {
    success: 'background: rgba(42, 250, 10, 1) !important; border-left: 4px solid #04ff25 !important;',
    error: 'background: rgba(239, 68, 68, 0.9); border-left: 4px solid #ef4444;',
    info: 'background: rgba(126, 162, 212, 0.9); border-left: 4px solid rgba(126, 162, 212, 1);',
    warning: 'background: rgba(249, 115, 22, 0.9); border-left: 4px solid #f97316;'
  };

  console.log('Toast styles loaded:', typeStyles);

  messageEl.style.cssText = styles + typeStyles[type];

  document.body.appendChild(messageEl);

  // Slide in
  setTimeout(() => {
    messageEl.style.transform = 'translateX(0)';
    messageEl.style.opacity = '1';
  }, 100);

  // Auto remove after 3 seconds
  setTimeout(() => {
    messageEl.style.transform = 'translateX(100%)';
    messageEl.style.opacity = '0';
    setTimeout(() => {
      if (messageEl.parentNode) {
        messageEl.parentNode.removeChild(messageEl);
      }
    }, 300);
  }, 3000);
};

// AI Assistant Interactive Functions
window.showAIMetrics = function(metricType) {
  const details = {
    responses: {
      title: 'AI Response Analytics',
      content: `
        <div class="modal-content">
          <h3>Response Statistics</h3>
          <div class="ai-analytics">
            <div class="analytics-item">
              <span>This Week:</span>
              <span>342 responses</span>
            </div>
            <div class="analytics-item">
              <span>This Month:</span>
              <span>1,289 responses</span>
            </div>
            <div class="analytics-item">
              <span>Success Rate:</span>
              <span>94.2%</span>
            </div>
            <div class="analytics-item">
              <span>Average Rating:</span>
              <span>4.6/5.0</span>
            </div>
          </div>
        </div>
        <style>
          .ai-analytics {
            padding: 20px 0;
          }
          .analytics-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(126, 162, 212, 0.1);
            color: #ffffff;
          }
          .analytics-item:last-child {
            border-bottom: none;
          }
          .analytics-item span:first-child {
            color: rgba(156, 163, 175, 1);
            font-weight: 500;
          }
          .analytics-item span:last-child {
            font-weight: 600;
            color: #22c55e;
          }
        </style>
      `
    },
    time: {
      title: 'Response Time Analytics',
      content: `
        <div class="modal-content">
          <h3>Performance Metrics</h3>
          <div class="time-analytics">
            <div class="time-item">
              <span>Average Response:</span>
              <span>1.2s</span>
            </div>
            <div class="time-item">
              <span>Fastest Response:</span>
              <span>0.8s</span>
            </div>
            <div class="time-item">
              <span>99th Percentile:</span>
              <span>2.1s</span>
            </div>
            <div class="time-item">
              <span>Uptime:</span>
              <span>99.9%</span>
            </div>
          </div>
        </div>
        <style>
          .time-analytics {
            padding: 20px 0;
          }
          .time-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(126, 162, 212, 0.1);
            color: #ffffff;
          }
          .time-item:last-child {
            border-bottom: none;
          }
          .time-item span:first-child {
            color: rgba(156, 163, 175, 1);
            font-weight: 500;
          }
          .time-item span:last-child {
            font-weight: 600;
            color: #22c55e;
          }
        </style>
      `
    }
  };

  showModal(details[metricType].title, details[metricType].content);
};

window.toggleAISetting = function(toggleElement) {
  const isChecked = toggleElement.checked;

  if (isChecked) {
    // Create custom toast with inline styles
    const customToast = document.createElement('div');
    customToast.innerHTML = 'AI auto-response enabled for lesson comments';
    customToast.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(65, 156, 98, 1) !important;
      color: white !important;
      padding: 14px 22px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      z-index: 10000;
      border-left: 4px solid rgb(22, 163, 74);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      min-width: 300px;
      animation: slideIn 0.3s ease forwards;
    `;

    // Add animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);

    document.body.appendChild(customToast);

    setTimeout(() => {
      customToast.remove();
      style.remove();
    }, 3000);
  } else {
    showMessage('AI auto-response disabled for lesson comments', 'info');
  }
};

window.openQuizAnalytics = function() {
  console.log('openQuizAnalytics function called');
  const quizAnalyticsHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Quizzes</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="backToDashboard()">‚Üê Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
            </div>
          </div>

          <!-- Content Management -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="content-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openCreateCourse()">Create Course</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMyCourses()">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft')">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived')">Archived</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openFinancePage()">Finance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link" onclick="openAIAssistantPage(); return false;">AI Assistant</a>
            </div>
          </div>

          <!-- Analytics -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent expanded" onclick="toggleMenu('analytics')">
              <span class="figma-menu-title">Analytics</span>
              <span class="figma-menu-arrow" id="analytics-arrow">‚ñº</span>
            </div>
            <div class="figma-menu-children" id="analytics-children">
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event); openQuizAnalytics()">Quiz analytics</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Rating & Comments</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Students analytics</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Engagement</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Progress</a>
            </div>
          </div>

          <!-- Rolls -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Rolls</a>
            </div>
          </div>

          <!-- Settings -->
          <div class="figma-menu-section">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">Settings</a>
            </div>
          </div>

          <!-- My Subscription -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- Quiz Analytics Content -->
        <div class="figma-content-area quiz-analytics-page">
          <style>
            .figma-content-area.quiz-analytics-page {
              padding: 24px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 24px !important;
            }
            .quiz-stats-grid {
              display: grid !important;
              grid-template-columns: repeat(3, 1fr) !important;
              gap: 20px !important;
              margin-bottom: 0 !important;
            }
            .quiz-stat-card {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 24px !important;
              text-align: center !important;
              transition: all 0.3s ease !important;
            }
            .quiz-stat-card:hover {
              background: rgba(58, 56, 56, 0.4) !important;
              border-color: rgba(126, 162, 212, 0.3) !important;
            }
            .quiz-stat-title {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              margin-bottom: 12px !important;
              text-transform: uppercase !important;
              letter-spacing: 0.5px !important;
            }
            .quiz-stat-value {
              color: #ffffff !important;
              font-size: 36px !important;
              font-weight: 700 !important;
              margin-bottom: 0 !important;
              line-height: 1 !important;
            }
            .quiz-tabs {
              display: flex !important;
              gap: 0 !important;
              background: rgba(20, 20, 20, 0.5) !important;
              border-radius: 12px !important;
              padding: 4px !important;
              margin-bottom: 24px !important;
            }
            .quiz-tab {
              flex: 1 !important;
              padding: 12px 20px !important;
              background: transparent !important;
              border: none !important;
              color: rgba(156, 163, 175, 1) !important;
              cursor: pointer !important;
              font-size: 14px !important;
              font-weight: 500 !important;
              border-radius: 8px !important;
              transition: all 0.3s ease !important;
            }
            .quiz-tab.active {
              background: rgba(126, 162, 212, 0.2) !important;
              color: rgba(126, 162, 212, 1) !important;
            }
            .quiz-content-section {
              background: rgba(58, 56, 56, 0.3) !important;
              border: 1px solid rgba(126, 162, 212, 0.2) !important;
              border-radius: 12px !important;
              padding: 0 !important;
              overflow: hidden !important;
            }
            .quiz-section-header {
              padding: 20px 24px !important;
              border-bottom: 1px solid rgba(126, 162, 212, 0.2) !important;
              color: #ffffff !important;
              font-size: 18px !important;
              font-weight: 600 !important;
              margin: 0 !important;
            }
            .quiz-list {
              padding: 16px !important;
              display: flex !important;
              flex-direction: column !important;
              gap: 16px !important;
            }
            .quiz-item {
              background: rgba(20, 20, 20, 0.4) !important;
              border: 1px solid rgba(126, 162, 212, 0.15) !important;
              border-radius: 8px !important;
              padding: 20px !important;
              transition: all 0.3s ease !important;
              cursor: pointer !important;
            }
            .quiz-item:hover {
              background: rgba(20, 20, 20, 0.6) !important;
              border-color: rgba(126, 162, 212, 0.3) !important;
            }
            .quiz-header {
              display: flex !important;
              justify-content: space-between !important;
              align-items: flex-start !important;
              margin-bottom: 12px !important;
            }
            .quiz-title {
              color: #ffffff !important;
              font-size: 16px !important;
              font-weight: 600 !important;
              margin: 0 0 4px 0 !important;
            }
            .quiz-meta {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              margin: 0 !important;
            }
            .quiz-actions {
              display: flex !important;
              gap: 8px !important;
            }
            .quiz-action-btn {
              background: transparent !important;
              border: 1px solid rgba(126, 162, 212, 0.4) !important;
              color: rgba(126, 162, 212, 1) !important;
              padding: 4px 8px !important;
              border-radius: 4px !important;
              font-size: 12px !important;
              cursor: pointer !important;
              transition: all 0.3s ease !important;
            }
            .quiz-action-btn:hover {
              background: rgba(126, 162, 212, 0.1) !important;
            }
            .quiz-description {
              color: rgba(156, 163, 175, 1) !important;
              font-size: 14px !important;
              margin: 0 !important;
              line-height: 1.4 !important;
            }
          </style>

          <!-- Stats Cards -->
          <div class="quiz-stats-grid">
            <div class="quiz-stat-card">
              <div class="quiz-stat-title">Total quizzes</div>
              <div class="quiz-stat-value">24</div>
            </div>
            <div class="quiz-stat-card">
              <div class="quiz-stat-title">Total Attempts</div>
              <div class="quiz-stat-value">2,845</div>
            </div>
            <div class="quiz-stat-card">
              <div class="quiz-stat-title">Average Score</div>
              <div class="quiz-stat-value">78%</div>
            </div>
          </div>

          <!-- Tab Navigation -->
          <div class="quiz-tabs">
            <button class="quiz-tab active" onclick="switchQuizTab('all', this)">All quizzes</button>
            <button class="quiz-tab" onclick="switchQuizTab('results', this)">Results & Analytics</button>
          </div>

          <!-- Quiz Content -->
          <div class="quiz-content-section">
            <h3 class="quiz-section-header">My quizzes</h3>
            <div class="quiz-list" id="quizList">
              <div class="quiz-item">
                <div class="quiz-header">
                  <div>
                    <h4 class="quiz-title">React Hooks Fundamentals Quiz</h4>
                    <p class="quiz-meta">React Masterclass ‚Ä¢ 20 questions ‚Ä¢ 30 min</p>
                  </div>
                  <div class="quiz-actions">
                    <button class="quiz-action-btn">‚ãØ</button>
                  </div>
                </div>
                <p class="quiz-description">Test your knowledge on React Hooks including useState, useEffect, useContext, and custom hooks.</p>
              </div>

              <div class="quiz-item">
                <div class="quiz-header">
                  <div>
                    <h4 class="quiz-title">Advanced CSS Grid Layout Quiz</h4>
                    <p class="quiz-meta">UI/UX Design ‚Ä¢ 15 questions ‚Ä¢ 25 min ‚Ä¢ AI</p>
                  </div>
                  <div class="quiz-actions">
                    <button class="quiz-action-btn">‚ãØ</button>
                  </div>
                </div>
                <p class="quiz-description">Master CSS Grid with advanced layout techniques and real-world use cases.</p>
              </div>

              <div class="quiz-item">
                <div class="quiz-header">
                  <div>
                    <h4 class="quiz-title">React Hooks Fundamentals Quiz</h4>
                    <p class="quiz-meta">React Masterclass ‚Ä¢ 20 questions ‚Ä¢ 30 min</p>
                  </div>
                  <div class="quiz-actions">
                    <button class="quiz-action-btn">‚ãØ</button>
                  </div>
                </div>
                <p class="quiz-description">Test your knowledge on React Hooks including useState, useEffect, useContext, and custom hooks.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  document.querySelector('#app').innerHTML = quizAnalyticsHTML;
  document.title = 'Quiz Analytics - darslinker';
};

window.switchQuizTab = function(tabType, tabElement) {
  // Remove active class from all tabs
  document.querySelectorAll('.quiz-tab').forEach(tab => {
    tab.classList.remove('active');
  });

  // Add active class to clicked tab
  tabElement.classList.add('active');

  const quizList = document.getElementById('quizList');

  if (tabType === 'results') {
    quizList.innerHTML = `
      <div class="quiz-item">
        <div class="quiz-header">
          <div>
            <h4 class="quiz-title">React Hooks Analytics</h4>
            <p class="quiz-meta">542 attempts ‚Ä¢ 76% average score</p>
          </div>
          <div class="quiz-actions">
            <button class="quiz-action-btn" onclick="showQuizAnalytics('react-hooks')">View Details</button>
          </div>
        </div>
        <p class="quiz-description">Most challenging questions: Custom hooks implementation, useEffect dependencies</p>
      </div>

      <div class="quiz-item">
        <div class="quiz-header">
          <div>
            <h4 class="quiz-title">CSS Grid Analytics</h4>
            <p class="quiz-meta">298 attempts ‚Ä¢ 81% average score</p>
          </div>
          <div class="quiz-actions">
            <button class="quiz-action-btn" onclick="showQuizAnalytics('css-grid')">View Details</button>
          </div>
        </div>
        <p class="quiz-description">Strong performance overall. Grid template areas most confusing topic.</p>
      </div>
    `;
  } else {
    quizList.innerHTML = `
      <div class="quiz-item">
        <div class="quiz-header">
          <div>
            <h4 class="quiz-title">React Hooks Fundamentals Quiz</h4>
            <p class="quiz-meta">React Masterclass ‚Ä¢ 20 questions ‚Ä¢ 30 min</p>
          </div>
          <div class="quiz-actions">
            <button class="quiz-action-btn">‚ãØ</button>
          </div>
        </div>
        <p class="quiz-description">Test your knowledge on React Hooks including useState, useEffect, useContext, and custom hooks.</p>
      </div>

      <div class="quiz-item">
        <div class="quiz-header">
          <div>
            <h4 class="quiz-title">Advanced CSS Grid Layout Quiz</h4>
            <p class="quiz-meta">UI/UX Design ‚Ä¢ 15 questions ‚Ä¢ 25 min ‚Ä¢ AI</p>
          </div>
          <div class="quiz-actions">
            <button class="quiz-action-btn">‚ãØ</button>
          </div>
        </div>
        <p class="quiz-description">Master CSS Grid with advanced layout techniques and real-world use cases.</p>
      </div>

      <div class="quiz-item">
        <div class="quiz-header">
          <div>
            <h4 class="quiz-title">React Hooks Fundamentals Quiz</h4>
            <p class="quiz-meta">React Masterclass ‚Ä¢ 20 questions ‚Ä¢ 30 min</p>
          </div>
          <div class="quiz-actions">
            <button class="quiz-action-btn">‚ãØ</button>
          </div>
        </div>
        <p class="quiz-description">Test your knowledge on React Hooks including useState, useEffect, useContext, and custom hooks.</p>
      </div>
    `;
  }
};

window.showQuizAnalytics = function(quizId) {
  // This would show detailed analytics for a specific quiz
  alert('Quiz analytics details for: ' + quizId);
};

window.editAIResponse = function(responseId) {
  const editForm = `
    <div class="modal-content" style="background: rgba(32, 32, 32, 0.95) !important; border: 1px solid rgba(126, 162, 212, 0.2) !important; border-radius: 12px !important; padding: 0 !important;">
      <div class="response-edit-form">
        <div class="form-group" style="margin-bottom: 20px;">
          <label class="form-label" style="color: rgba(156, 163, 175, 1) !important; font-size: 14px !important; font-weight: 600 !important; margin-bottom: 8px !important; display: block !important;">Student Question:</label>
          <textarea class="form-textarea" readonly style="width: 100% !important; background: rgba(20, 20, 20, 0.8) !important; border: 1px solid rgba(126, 162, 212, 0.2) !important; border-radius: 8px !important; padding: 12px !important; color: rgba(156, 163, 175, 0.8) !important; font-family: inherit !important; font-size: 14px !important; line-height: 1.5 !important; resize: vertical !important; min-height: 80px !important;">What's the difference between useState and useEffect?</textarea>
        </div>
        <div class="form-group" style="margin-bottom: 24px;">
          <label class="form-label" style="color: rgba(156, 163, 175, 1) !important; font-size: 14px !important; font-weight: 600 !important; margin-bottom: 8px !important; display: block !important;">AI Response:</label>
          <textarea class="form-textarea" rows="4" id="aiResponseEdit" style="width: 100% !important; background: rgba(20, 20, 20, 0.8) !important; border: 1px solid rgba(126, 162, 212, 0.2) !important; border-radius: 8px !important; padding: 12px !important; color: #ffffff !important; font-family: inherit !important; font-size: 14px !important; line-height: 1.5 !important; resize: vertical !important; min-height: 120px !important;">useState manages component state, while useEffect handles side effects like API calls. Check Lesson 5 for examples!</textarea>
        </div>
        <div class="response-actions" style="display: flex !important; gap: 12px !important; flex-wrap: wrap !important;">
          <button class="save-response-btn" onclick="saveAIResponse(${responseId})" style="background: rgba(34, 197, 94, 0.2) !important; border: 1px solid rgba(34, 197, 94, 0.4) !important; color: #22c55e !important; padding: 12px 20px !important; border-radius: 8px !important; cursor: pointer !important; font-weight: 600 !important; flex: 1 !important; min-width: 120px !important; transition: all 0.3s ease !important;" onmouseover="this.style.background='rgba(34, 197, 94, 0.3)'" onmouseout="this.style.background='rgba(34, 197, 94, 0.2)'">Save Changes</button>
          <button class="regenerate-btn" onclick="regenerateAIResponse(${responseId})" style="background: rgba(126, 162, 212, 0.2) !important; border: 1px solid rgba(126, 162, 212, 0.4) !important; color: rgba(126, 162, 212, 1) !important; padding: 12px 20px !important; border-radius: 8px !important; cursor: pointer !important; font-weight: 600 !important; flex: 1 !important; min-width: 120px !important; transition: all 0.3s ease !important;" onmouseover="this.style.background='rgba(126, 162, 212, 0.3)'" onmouseout="this.style.background='rgba(126, 162, 212, 0.2)'">Regenerate</button>
          <button class="cancel-btn" onclick="closeModal()" style="background: rgba(75, 85, 99, 0.2) !important; border: 1px solid rgba(75, 85, 99, 0.4) !important; color: rgba(156, 163, 175, 1) !important; padding: 12px 20px !important; border-radius: 8px !important; cursor: pointer !important; font-weight: 600 !important; flex: 1 !important; min-width: 120px !important; transition: all 0.3s ease !important;" onmouseover="this.style.background='rgba(75, 85, 99, 0.3)'" onmouseout="this.style.background='rgba(75, 85, 99, 0.2)'">Cancel</button>
        </div>
      </div>
    </div>
  `;

  showModal('Edit AI Response', editForm);
};

window.saveAIResponse = function(responseId) {
  showMessage('AI response updated successfully!', 'success');
  closeModal();
};

window.regenerateAIResponse = function(responseId) {
  showMessage('Regenerating AI response...', 'info');

  // Simulate AI regeneration delay
  setTimeout(() => {
    document.getElementById('aiResponseEdit').value = 'useState is a React Hook for managing local component state, while useEffect is used for side effects like API calls, subscriptions, and DOM manipulation. For more examples, see Lesson 5 and the official React documentation.';
    showMessage('AI response regenerated successfully!', 'success');
  }, 2000);
};

window.showModal = function(title, content) {
  const modal = `
    <div class="finance-modal" onclick="closeModal()">
      <div class="finance-modal-content" onclick="event.stopPropagation()">
        <div class="finance-modal-header">
          <h3>${title}</h3>
          <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="finance-modal-body">
          ${content}
        </div>
      </div>
    </div>
    <style>
      .finance-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .finance-modal-content {
        background: rgba(20, 20, 20, 0.95);
        border: 1px solid rgba(126, 162, 212, 0.3);
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 80%;
        overflow-y: auto;
      }
      .finance-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid rgba(126, 162, 212, 0.2);
      }
      .finance-modal-header h3 {
        color: rgba(126, 162, 212, 1);
        margin: 0;
      }
      .close-btn {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .finance-modal-body {
        padding: 20px;
        color: #ffffff;
      }
      .revenue-item, .stat-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(126, 162, 212, 0.1);
      }
      .revenue-total {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        font-weight: bold;
        font-size: 16px;
        border-top: 2px solid rgba(126, 162, 212, 0.3);
        margin-top: 10px;
      }
      .withdraw-btn {
        background: rgba(126, 162, 212, 0.2);
        border: 1px solid rgba(126, 162, 212, 0.4);
        color: rgba(126, 162, 212, 1);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 15px;
        font-weight: 600;
      }
      .withdraw-btn:hover {
        background: rgba(126, 162, 212, 0.3);
      }
    </style>
  `;

  document.body.insertAdjacentHTML('beforeend', modal);
};

window.closeModal = function() {
  const modal = document.querySelector('.finance-modal');
  if (modal) {
    modal.remove();
  }
};

window.downloadReport = (format) => {
  showMessage(`Downloading ${format.toUpperCase()} report...`, 'info');
  // Simulate download
  setTimeout(() => {
    showMessage(`${format.toUpperCase()} report downloaded successfully!`, 'success');
  }, 2000);
};

window.requestPayout = () => {
  showModal('Request Payout', `
    <div class="modal-content">
      <h3>Payout Request</h3>
      <div class="payout-form">
        <div class="form-group">
          <label>Amount:</label>
          <input type="number" value="1250" max="1250" class="payout-input" />
        </div>
        <div class="form-group">
          <label>Payment Method:</label>
          <select class="payout-select">
            <option>UzBank Card ****1234</option>
            <option>Bank Transfer</option>
          </select>
        </div>
        <button class="payout-submit-btn" onclick="submitPayout()">Submit Request</button>
      </div>
    </div>
    <style>
      .payout-form .form-group {
        margin-bottom: 15px;
      }
      .payout-form label {
        display: block;
        margin-bottom: 5px;
        color: rgba(126, 162, 212, 1);
        font-weight: 500;
      }
      .payout-input, .payout-select {
        width: 100%;
        padding: 10px;
        background: rgba(58, 56, 56, 0.3);
        border: 1px solid rgba(126, 162, 212, 0.2);
        border-radius: 8px;
        color: #ffffff;
        font-size: 14px;
      }
      .payout-submit-btn {
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #22c55e;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        width: 100%;
      }
      .payout-submit-btn:hover {
        background: rgba(34, 197, 94, 0.3);
      }
    </style>
  `);
};

window.submitPayout = function() {
  showMessage('Payout request submitted successfully! Processing will take 2-3 business days.', 'success');
  closeModal();
};

// Open Create Course Page
window.openCreateCourse = function() {
  const userData = store.getState().user;

  // Check current general menu state before navigating
  const generalChildren = document.getElementById('general-children');
  const isGeneralExpanded = generalChildren && !generalChildren.classList.contains('hidden');

  // Check content management menu state
  const contentChildren = document.getElementById('content-children');
  const isContentExpanded = contentChildren && !contentChildren.classList.contains('hidden');

  document.querySelector('#app').innerHTML = `
    <div class="figma-dashboard">
      <!-- Top Header -->
      <div class="figma-header">
        <div class="figma-logo">
          <h1>dars<span>linker</span></h1>
        </div>
        <div class="figma-title">
          <h2>Create course</h2>
        </div>
        <div class="figma-header-buttons">
          <button class="figma-btn" onclick="backToDashboard()">‚Üê Back</button>
        </div>
      </div>

      <!-- Main Layout -->
      <div class="figma-main-layout">
        <!-- Left Sidebar Menu -->
        <div class="figma-sidebar">
          <!-- General Menu -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isGeneralExpanded ? 'expanded' : ''}" onclick="toggleMenu('general')">
              <span class="figma-menu-title">General</span>
              <span class="figma-menu-arrow" id="general-arrow">${isGeneralExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isGeneralExpanded ? '' : 'hidden'}" id="general-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); backToDashboard()">Dashboard</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openEditProfile()">Profile</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openMessagesPage()">Messages</a>
            </div>
          </div>

          <!-- Content Management -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent ${isContentExpanded ? 'expanded' : ''}" onclick="toggleMenu('content')">
              <span class="figma-menu-title">Content Management</span>
              <span class="figma-menu-arrow" id="content-arrow">${isContentExpanded ? '‚ñº' : '‚ñ∂'}</span>
            </div>
            <div class="figma-menu-children ${isContentExpanded ? '' : 'hidden'}" id="content-children">
              <a href="#" class="figma-menu-child active" onclick="setActiveChild(this, event)">Create Course</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">My Courses</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('draft')">Drafts</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); filterFromSidebar('archived')">Archived</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Finance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event); openAssignmentsPage()">Assignments</a>
            </div>
          </div>

          <!-- AI Assistant -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="openAIAssistantPage(); return false;">
              <span class="figma-menu-title">AI Assistant</span>
              <span class="figma-menu-arrow" id="ai-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="ai-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Chat Assistant</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Content Generator</a>
            </div>
          </div>

          <!-- Analytics -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('analytics')">
              <span class="figma-menu-title">Analytics</span>
              <span class="figma-menu-arrow" id="analytics-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="analytics-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Student Progress</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Course Analytics</a>
            </div>
          </div>

          <!-- Rolls -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('rolls')">
              <span class="figma-menu-title">Rolls</span>
              <span class="figma-menu-arrow" id="rolls-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="rolls-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Attendance</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Grade Book</a>
            </div>
          </div>

          <!-- Settings -->
          <div class="figma-menu-section">
            <div class="figma-menu-parent" onclick="toggleMenu('settings')">
              <span class="figma-menu-title">Settings</span>
              <span class="figma-menu-arrow" id="settings-arrow">‚ñ∂</span>
            </div>
            <div class="figma-menu-children hidden" id="settings-children">
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Account Settings</a>
              <a href="#" class="figma-menu-child" onclick="setActiveChild(this, event)">Preferences</a>
            </div>
          </div>

          <!-- Subscription -->
          <div class="figma-subscription">
            <div class="figma-menu-single">
              <a href="#" class="figma-single-link">My Subscription</a>
            </div>
          </div>
        </div>

        <!-- Create Course Content -->
        <div class="figma-content-area">
          <form class="create-course-form" id="createCourseForm">

            <!-- Basic Information Section -->
            <div class="course-section">
              <h3 class="course-section-title">Basic information</h3>

              <div class="form-field">
                <label class="field-label">Course Title *</label>
                <input type="text" class="form-input" placeholder="e.g. Complete React developer course 2025" required />
              </div>

              <div class="form-field">
                <label class="field-label">Short description *</label>
                <textarea class="form-textarea" rows="2" placeholder="Write a brief description of your course(2-3 sentences)" required></textarea>
              </div>

              <div class="form-field">
                <label class="field-label">Full description *</label>
                <textarea class="form-textarea" rows="4" placeholder="Detailed course description, what students will learn, prerequisites, etc" required></textarea>
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">Category *</label>
                  <input type="text" class="form-input" placeholder="Machine learning" required />
                </div>
                <div class="form-field">
                  <label class="field-label">Level *</label>
                  <input type="text" class="form-input" placeholder="e.g. Intermediate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">Language *</label>
                  <input type="text" class="form-input" placeholder="e.g. English" required />
                </div>
                <div class="form-field">
                  <label class="field-label">Duration (hours) *</label>
                  <input type="text" class="form-input" placeholder="e.g. 15 hours" required />
                </div>
              </div>
            </div>

            <!-- Course Image Section -->
            <div class="course-section">
              <h3 class="course-section-title">Course Image</h3>

              <div class="form-field">
                <label class="field-label">Course Thumbnail *</label>
                <div class="upload-area" id="uploadArea" onclick="triggerFileUpload()">
                  <input type="file" id="thumbnailInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)" />
                  <div class="upload-content" id="uploadContent">
                    <div class="upload-icon">
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"/>
                      </svg>
                    </div>
                    <div class="upload-text">
                      <p>Click to upload course thumbnail</p>
                      <small>Recommended: 1280x720px, PNG or JPG, max 5MB</small>
                    </div>
                  </div>
                  <div class="image-preview hidden" id="imagePreview">
                    <img id="previewImg" src="" alt="Course thumbnail" />
                    <div class="image-overlay">
                      <button type="button" class="image-action-btn" onclick="changeImage(event)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Change
                      </button>
                      <button type="button" class="image-action-btn delete" onclick="deleteImage(event)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14zM10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-field">
                <label class="field-label">Preview Video URL (optional)</label>
                <input type="url" class="form-input" placeholder="https://youtube.com/watch?=..." />
                <small class="field-note">Add a preview video to attract more students</small>
              </div>
            </div>

            <!-- Pricing & Access Section -->
            <div class="course-section">
              <h3 class="course-section-title">Pricing & Access</h3>

              <div class="form-field">
                <label class="field-label">Course type *</label>
                <div class="radio-group">
                  <label class="radio-option">
                    <input type="radio" name="courseType" value="paid" checked />
                    <span class="radio-custom"></span>
                    <span>Paid</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="courseType" value="free" />
                    <span class="radio-custom"></span>
                    <span>Free</span>
                  </label>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label class="field-label">Course Price (USD) *</label>
                  <input type="number" class="form-input" placeholder="49.99" step="0.01" />
                </div>
                <div class="form-field">
                  <label class="field-label">Discount Price (optional)</label>
                  <input type="number" class="form-input" placeholder="29.99" step="0.01" />
                  <small class="field-note">Leave empty if no discount</small>
                </div>
              </div>
            </div>

            <!-- Course Structure Section -->
            <div class="course-section">
              <h3 class="course-section-title">Course Structure (Modules & Lessons)</h3>

              <div class="info-tip">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                  <path d="M12 16v-4M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Tip: Organize your course into modules (sections) and lessons. You can add videos, files, and quizzes later.</span>
              </div>

              <div class="modules-container" id="modulesContainer">
                <!-- Module 1 -->
                <div class="module-item">
                  <div class="module-header" onclick="toggleModule(this)">
                    <div class="module-info">
                      <h4>Module 1: Introduction to React</h4>
                      <p>5 lessons ‚Ä¢ 2 hours</p>
                    </div>
                    <div class="module-actions" onclick="event.stopPropagation()">
                      <button type="button" class="action-btn" onclick="editModule(this)">Edit</button>
                      <button type="button" class="action-btn delete" onclick="deleteModule(this)">Delete</button>
                    </div>
                  </div>
                  <div class="lessons-list" style="display: none;">
                    <div class="lesson-item">
                      <span>Lesson 1: What is React?</span>
                      <span>15 min</span>
                    </div>
                    <div class="lesson-item">
                      <span>Lesson 2: Setting Up React</span>
                      <span>45 min</span>
                    </div>
                    <div class="add-lesson-dropdown">
                      <button type="button" class="add-btn dropdown-toggle" onclick="toggleLessonDropdown(this)">+ Add</button>
                      <div class="dropdown-menu">
                        <a href="#" onclick="addLesson('video', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Video
                        </a>
                        <a href="#" onclick="addLesson('quiz', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2"/>
                            <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Quiz
                        </a>
                        <a href="#" onclick="addLesson('assignment', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Assignment
                        </a>
                        <a href="#" onclick="addLesson('file', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2"/>
                            <polyline points="13,2 13,9 20,9" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          File
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Module 2 -->
                <div class="module-item">
                  <div class="module-header" onclick="toggleModule(this)">
                    <div class="module-info">
                      <h4>Module 2: Advanced React Concepts</h4>
                      <p>0 lessons ‚Ä¢ 0 hours</p>
                    </div>
                    <div class="module-actions" onclick="event.stopPropagation()">
                      <button type="button" class="action-btn" onclick="editModule(this)">Edit</button>
                      <button type="button" class="action-btn delete" onclick="deleteModule(this)">Delete</button>
                    </div>
                  </div>
                  <div class="lessons-list" style="display: none;">
                    <div class="add-lesson-dropdown">
                      <button type="button" class="add-btn dropdown-toggle" onclick="toggleLessonDropdown(this)">+ Add</button>
                      <div class="dropdown-menu">
                        <a href="#" onclick="addLesson('video', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Video
                        </a>
                        <a href="#" onclick="addLesson('quiz', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2"/>
                            <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Quiz
                        </a>
                        <a href="#" onclick="addLesson('assignment', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          Assignment
                        </a>
                        <a href="#" onclick="addLesson('file', this)">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2"/>
                            <polyline points="13,2 13,9 20,9" stroke="currentColor" stroke-width="2"/>
                          </svg>
                          File
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

                <button type="button" class="add-module-btn" onclick="addNewModule()">Add new module</button>
              </div>
            </div>

            <!-- Additional Settings Section -->
            <div class="course-section">
              <h3 class="course-section-title">Additional Settings</h3>

              <div class="settings-list">
                <div class="setting-item">
                  <div class="setting-info">
                    <h4>Enable Q&A for students</h4>
                    <p>Students can ask questions under lessons</p>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>Enable AI auto-responses</h4>
                    <p>AI will automatically answer common student questions</p>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" />
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="setting-item">
                  <div class="setting-info">
                    <h4>Issue certificate upon completion</h4>
                    <p>Students receive a certificate when they finish the course</p>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions course-actions">
              <button type="button" class="btn-cancel" onclick="backToDashboard()">Save as draft</button>
              <button type="submit" class="btn-save">Publish course</button>
            </div>

          </form>
        </div>
      </div>
    </div>
  `;
};

// ===== MY COURSES FUNCTIONALITY =====

// Global variables for filtering and sorting
let currentFilter = 'all';
let currentSort = 'newest';
let currentSearch = '';

// Update courses statistics dynamically
function updateCoursesStatistics() {
  const stats = calculateCoursesStatistics();
  const statsContainer = document.getElementById('coursesStats');

  if (!statsContainer) return;

  statsContainer.innerHTML = `
    <div class="stat-card-my-courses">
      <h3>Total courses</h3>
      <div class="stat-number">${stats.totalCourses}</div>
      <div class="stat-change positive">+${stats.newThisMonth} new this month</div>
    </div>
    <div class="stat-card-my-courses">
      <h3>Total enrolled</h3>
      <div class="stat-number">${stats.totalStudents.toLocaleString()}</div>
      <div class="stat-change positive">+${stats.newStudents} new students</div>
    </div>
    <div class="stat-card-my-courses">
      <h3>Total revenue</h3>
      <div class="stat-number">$${stats.totalRevenue.toLocaleString()}</div>
      <div class="stat-change positive">+$${stats.monthlyRevenue.toLocaleString()} this month</div>
    </div>
    <div class="stat-card-my-courses">
      <h3>Live now</h3>
      <div class="stat-number">${stats.activeStudents}</div>
      <div class="stat-change">Students online</div>
    </div>
  `;
}

// Calculate real statistics from courses data
function calculateCoursesStatistics() {
  const totalCourses = myCoursesData.length;
  const totalStudents = myCoursesData.reduce((sum, course) => sum + course.students, 0);
  const totalRevenue = myCoursesData.reduce((sum, course) => sum + course.revenue, 0);

  // Calculate new courses this month (November 2024)
  const thisMonth = new Date().toISOString().slice(0, 7); // "2024-11"
  const newThisMonth = myCoursesData.filter(course =>
    course.createdAt.startsWith(thisMonth)
  ).length;

  // Simulate some dynamic values
  const newStudents = Math.floor(totalStudents * 0.05); // 5% of total as new
  const monthlyRevenue = Math.floor(totalRevenue * 0.1); // 10% of total as monthly
  const activeStudents = Math.floor(totalStudents * 0.08); // 8% online now

  return {
    totalCourses,
    totalStudents,
    totalRevenue,
    newThisMonth,
    newStudents,
    monthlyRevenue,
    activeStudents
  };
}

// Update filter tabs with real counts
function updateFilterTabs() {
  const counts = {
    all: myCoursesData.length,
    active: myCoursesData.filter(course => course.status === 'Active').length,
    draft: myCoursesData.filter(course => course.status === 'Draft').length,
    archived: myCoursesData.filter(course => course.status === 'Archived').length,
    free: myCoursesData.filter(course => course.type === 'Free').length,
    paid: myCoursesData.filter(course => course.type === 'Paid').length
  };

  const tabsContainer = document.getElementById('courseFilterTabs');
  if (!tabsContainer) return;

  tabsContainer.innerHTML = `
    <button class="filter-tab active" data-filter="all" onclick="filterCoursesByTab(this, 'all')">All courses (${counts.all})</button>
    <button class="filter-tab" data-filter="active" onclick="filterCoursesByTab(this, 'active')">Active (${counts.active})</button>
    <button class="filter-tab" data-filter="draft" onclick="filterCoursesByTab(this, 'draft')">Draft (${counts.draft})</button>
    <button class="filter-tab" data-filter="archived" onclick="filterCoursesByTab(this, 'archived')">Archived (${counts.archived})</button>
    <button class="filter-tab" data-filter="free" onclick="filterCoursesByTab(this, 'free')">Free (${counts.free})</button>
    <button class="filter-tab" data-filter="paid" onclick="filterCoursesByTab(this, 'paid')">Paid (${counts.paid})</button>
  `;
}

// Render my courses cards into the grid
function renderMyCoursesCards(courses = myCoursesData) {
  const grid = document.getElementById('myCoursesGrid');
  if (!grid) return;

  // Apply current filters and search
  courses = applyCurrentFilters(courses);

  if (courses.length === 0) {
    grid.innerHTML = '<div class="no-courses">No courses found with current filters.</div>';
    return;
  }

  grid.innerHTML = courses.map(course => `
    <div class="my-course-card" data-course-id="${course.id}">
      <div class="course-thumbnail" style="background: ${course.color}">
        <div class="course-category-icon">
          ${getCategoryIcon(course.category)}
        </div>
      </div>
      <div class="course-status-badge status-${course.status.toLowerCase()}">${course.status}</div>
      <div class="course-card-body">
        <h3 class="course-card-title">${course.title}</h3>
        <p class="course-card-description">${course.description}</p>
        <div class="course-stats-row">
          <div class="course-stat">
            <div class="stat-number">${course.students.toLocaleString()}</div>
            <div class="stat-label">Students</div>
          </div>
          <div class="course-stat">
            <div class="stat-number">${course.rating}</div>
            <div class="stat-label">Rating</div>
          </div>
        </div>
        <div class="course-stats-row">
          <div class="course-stat">
            <div class="stat-number">${course.lessons}</div>
            <div class="stat-label">Lessons</div>
          </div>
          <div class="course-stat">
            <div class="stat-number">${course.price > 0 ? '$' + course.price : 'Free'}</div>
            <div class="stat-label">Price</div>
          </div>
        </div>
        <div class="course-revenue">
          <span class="revenue-label">Revenue</span>
          <span class="revenue-amount">$${course.revenue.toLocaleString()}</span>
        </div>
        <div class="course-actions">
          <button class="course-btn" onclick="editCourse(${course.id})" title="Edit course">Edit</button>
          <button class="course-btn" onclick="viewCourseStats(${course.id})" title="View statistics">Stats</button>
          <button class="course-btn course-btn-delete" onclick="deleteCourse(${course.id})" title="Delete course">Delete</button>
        </div>
      </div>
    </div>
  `).join('');
}

// Apply current filters, search and sort
function applyCurrentFilters(courses) {
  let filtered = [...courses];

  // Apply status/type filter
  if (currentFilter !== 'all') {
    switch (currentFilter) {
      case 'active':
        filtered = filtered.filter(course => course.status === 'Active');
        break;
      case 'draft':
        filtered = filtered.filter(course => course.status === 'Draft');
        break;
      case 'archived':
        filtered = filtered.filter(course => course.status === 'Archived');
        break;
      case 'free':
        filtered = filtered.filter(course => course.type === 'Free');
        break;
      case 'paid':
        filtered = filtered.filter(course => course.type === 'Paid');
        break;
    }
  }

  // Apply search filter
  if (currentSearch) {
    filtered = filtered.filter(course =>
      course.title.toLowerCase().includes(currentSearch.toLowerCase()) ||
      course.description.toLowerCase().includes(currentSearch.toLowerCase()) ||
      course.category.toLowerCase().includes(currentSearch.toLowerCase())
    );
  }

  // Apply sorting
  switch (currentSort) {
    case 'oldest':
      filtered.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
      break;
    case 'name-asc':
      filtered.sort((a, b) => a.title.localeCompare(b.title));
      break;
    case 'name-desc':
      filtered.sort((a, b) => b.title.localeCompare(a.title));
      break;
    case 'students-desc':
      filtered.sort((a, b) => b.students - a.students);
      break;
    case 'revenue-desc':
      filtered.sort((a, b) => b.revenue - a.revenue);
      break;
    case 'rating-desc':
      filtered.sort((a, b) => b.rating - a.rating);
      break;
    case 'newest':
    default:
      filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      break;
  }

  return filtered;
}

// Filter courses by tab
window.filterCoursesByTab = function(tabElement, filter) {
  // Remove active class from all tabs
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.classList.remove('active');
  });

  // Add active class to clicked tab
  tabElement.classList.add('active');

  // Update current filter
  currentFilter = filter;

  // Re-render courses
  renderMyCoursesCards();

  // Update sidebar menu active state
  document.querySelectorAll('.figma-menu-child').forEach(item => {
    item.classList.remove('active');
  });

  // Set "My Courses" as active when using filter tabs
  const myCoursesMenuItem = document.getElementById('my-courses-menu');

  if (filter === 'all' && myCoursesMenuItem) {
    myCoursesMenuItem.classList.add('active');
  }

  // Update page title only if we're on My Courses page
  const titleElement = document.querySelector('.figma-title h2');
  if (titleElement && document.getElementById('myCoursesGrid')) {
    const filterTitles = {
      all: 'My courses',
      active: 'My Courses - Active',
      draft: 'My Courses - Drafts',
      archived: 'My Courses - Archived',
      free: 'My Courses - Free',
      paid: 'My Courses - Paid'
    };
    titleElement.textContent = filterTitles[filter] || 'My courses';
  }
};

// Search courses
window.searchCourses = function() {
  const searchInput = document.getElementById('courseSearchInput');
  currentSearch = searchInput ? searchInput.value : '';
  renderMyCoursesCards();
};

// Sort courses
window.sortCourses = function() {
  const sortSelect = document.getElementById('courseSortSelect');
  currentSort = sortSelect ? sortSelect.value : 'newest';
  renderMyCoursesCards();
};

// Enhanced course action functions
window.viewCourseStats = function(id) {
  const course = myCoursesData.find(c => c.id === id);
  if (!course) return;

  const statsModal = `
    <div class="course-stats-modal" onclick="closeStatsModal()">
      <div class="stats-modal-content" onclick="event.stopPropagation()">
        <div class="stats-modal-header">
          <h3>${course.title} - Statistics</h3>
          <button onclick="closeStatsModal()" class="close-modal-btn">&times;</button>
        </div>
        <div class="stats-modal-body">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value">${course.students.toLocaleString()}</div>
              <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${course.lessons}</div>
              <div class="stat-label">Lessons</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${course.rating}/5</div>
              <div class="stat-label">Average Rating</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">$${course.revenue.toLocaleString()}</div>
              <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${course.status}</div>
              <div class="stat-label">Status</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">${course.type}</div>
              <div class="stat-label">Type</div>
            </div>
          </div>
          <div class="stats-details">
            <h4>Course Details</h4>
            <p><strong>Category:</strong> ${course.category}</p>
            <p><strong>Created:</strong> ${new Date(course.createdAt).toLocaleDateString()}</p>
            <p><strong>Last Updated:</strong> ${new Date(course.updatedAt).toLocaleDateString()}</p>
            <p><strong>Price:</strong> ${course.price > 0 ? '$' + course.price : 'Free'}</p>
          </div>
        </div>
      </div>
    </div>
  `;

  document.body.insertAdjacentHTML('beforeend', statsModal);
};

window.closeStatsModal = function() {
  const modal = document.querySelector('.course-stats-modal');
  if (modal) modal.remove();
};

window.editCourse = function(id) {
  const course = myCoursesData.find(c => c.id === id);
  if (!course) return;

  // Simple edit functionality - in a real app this would open an edit form
  const newTitle = prompt('Edit course title:', course.title);
  if (newTitle && newTitle !== course.title) {
    course.title = newTitle;
    course.updatedAt = new Date().toISOString().slice(0, 10);
    renderMyCoursesCards();

    // Show success message
    showMessage('Course updated successfully!', 'success');
  }
};

window.deleteCourse = function(id) {
  const course = myCoursesData.find(c => c.id === id);
  if (!course) return;

  if (confirm(`Are you sure you want to delete "${course.title}"? This action cannot be undone.`)) {
    // Remove course from array
    const index = myCoursesData.findIndex(c => c.id === id);
    if (index > -1) {
      myCoursesData.splice(index, 1);

      // Update statistics and tabs
      updateCoursesStatistics();
      updateFilterTabs();
      renderMyCoursesCards();

      showMessage('Course deleted successfully!', 'success');
    }
  }
};

// Filter from sidebar menu - works from any page
window.filterFromSidebar = function(filterType) {
  // Always store the filter to apply
  sessionStorage.setItem('pendingFilter', filterType);

  // Check if we're already on My Courses page
  const isOnMyCoursesPage = document.getElementById('myCoursesGrid') !== null;

  if (!isOnMyCoursesPage) {
    // If not on My Courses page, navigate to it
    openMyCourses();
    return;
  }

  // If already on My Courses page, apply filter immediately
  applyFilterFromSidebar(filterType);
};

// Apply filter logic (extracted for reuse)
function applyFilterFromSidebar(filterType) {
  // Only apply if we're on My Courses page
  if (!document.getElementById('myCoursesGrid')) {
    return;
  }

  // Update sidebar menu active state
  document.querySelectorAll('.figma-menu-child').forEach(item => {
    item.classList.remove('active');
  });

  // Set active state for the clicked item
  const menuItems = {
    draft: document.querySelector('[onclick*="filterFromSidebar(\'draft\')"]'),
    archived: document.querySelector('[onclick*="filterFromSidebar(\'archived\')"]')
  };

  if (menuItems[filterType]) {
    menuItems[filterType].classList.add('active');
  }

  // Update the filter tabs to match sidebar selection
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.classList.remove('active');
    if (tab.getAttribute('data-filter') === filterType) {
      tab.classList.add('active');
    }
  });

  // Update current filter and re-render
  currentFilter = filterType;
  renderMyCoursesCards();

  // Update page title based on filter
  const titleElement = document.querySelector('.figma-title h2');
  if (titleElement) {
    const filterTitles = {
      draft: 'My Courses - Drafts',
      archived: 'My Courses - Archived'
    };
    titleElement.textContent = filterTitles[filterType] || 'My courses';
  }

  // Update header button text to match current filter
  const backButton = document.querySelector('[onclick*="backToDashboard"]');
  if (backButton) {
    const newText = filterType === 'draft' ? '‚Üê Back to All Courses' :
                    filterType === 'archived' ? '‚Üê Back to All Courses' : '‚Üê Back';
    backButton.textContent = newText;
  }
}

// Get category icon
function getCategoryIcon(category) {
  const icons = {
    'Web Development': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z"/><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"/></svg>',
    'Design': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',
    'Programming': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M8 4l-6 8 6 8M16 4l6 8-6 8M11 2l-2 20"/></svg>',
    'Mobile Development': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M7 1h10a2 2 0 012 2v18a2 2 0 01-2 2H7a2 2 0 01-2-2V3a2 2 0 012-2zm0 2v18h10V3H7z"/></svg>',
    'Marketing': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
    'Security': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>',
    'Data Science': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h18v2H3V3zm0 4h12v2H3V7zm0 4h18v2H3v-2zm0 4h12v2H3v-2zm0 4h18v2H3v-2z"/></svg>',
    'Blockchain': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>',
    'Machine Learning': '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>'
  };

  return icons[category] || '<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
}

// Helper function to show messages
function showMessage(message, type = 'info') {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message-toast message-${type}`;
  messageDiv.textContent = message;

  document.body.appendChild(messageDiv);

  setTimeout(() => {
    messageDiv.classList.add('show');
  }, 100);

  setTimeout(() => {
    messageDiv.classList.remove('show');
    setTimeout(() => messageDiv.remove(), 300);
  }, 3000);
}
// Ensure AI Assistant function is globally accessible
window.openAIAssistantPage = openAIAssistantPage;
